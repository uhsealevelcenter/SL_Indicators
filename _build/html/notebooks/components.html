

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Components &#8212; Hawaii Sea Level Indicators</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/components';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Nonstationary Extremes" href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html" />
    <link rel="prev" title="Annual Extremes" href="regional_and_local/SL_Extremes_annual.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">In development! Please post issues and suggestions to github.</div>
  </div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/trend_map.png" class="logo__image only-light" alt="Hawaii Sea Level Indicators - Home"/>
    <script>document.write(`<img src="../_static/trend_map.png" class="logo__image only-dark" alt="Hawaii Sea Level Indicators - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://uhslc.soest.hawaii.edu/jfiedler/SeaLevelIndicators/">Indicator Matrix</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../gettingStarted.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="SL_Data_Wrangling.html">Data Wrangling</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ANNUAL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="SL_annual.html">Sea Level Magnitude</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Trend.html">Sea Level Trend</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_anomaly_annual.html">Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Rankings_annual.html">Annual Sea Level Rankings</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Extremes_annual.html">Annual Extremes</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html">Nonstationary Extremes</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributions.html">Contributions</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Flood.html">Minor Flood Frequency and Duration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="FloodFrequency.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="FloodDuration.html">Flood Duration</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">INTRA-ANNUAL</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="SL_intra-annual.html">Sea Level Magnitude</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_anomaly_intra-annual.html">Intra-Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Extremes_intra-annual.html">Intra-Annual Extremes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Flood_intra-annual.html">Minor Flood Frequency and Duration</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="FloodFrequency_intra-annual.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="FloodDuration_intra-annual.html">Flood Duration</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jwfiedler/SL_Hawaii/main?urlpath=tree/notebooks/components.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/edit/main/notebooks/components.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/issues/new?title=Issue%20on%20page%20%2Fnotebooks/components.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/components.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Components</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtain-the-non-tidal-residual-ntr">Obtain the Non-tidal Residual (NTR)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-inspect">Plot and Inspect</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-examine-the-nodal-modulation-a-bit-more">Let’s examine the Nodal modulation a bit more</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-components">Plot components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-a-table">Make a Table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-a-map">Make a map</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="components">
<h1>Components<a class="headerlink" href="#components" title="Permalink to this heading">#</a></h1>
<figure class="align-right">
<a class="reference internal image-reference" href="../_images/e0d0a122c6d88581283e43bf2b9550963117938fffde5adbe134538d9dafd7ac.png"><img alt="../_images/e0d0a122c6d88581283e43bf2b9550963117938fffde5adbe134538d9dafd7ac.png" src="../_images/e0d0a122c6d88581283e43bf2b9550963117938fffde5adbe134538d9dafd7ac.png" style="width: 212.5px; height: 423.5px;" /></a>
</figure>
<p>In this notebook we’ll explore the various contributions to high and low water levels. At the moment this is exploratory - we are using this to take broad stroke looks. We’ll do this by breaking down the time series of hourly water levels at a tide gauge into different frequency bands, with the idea that certain processes fall within these timescales. For example, we know that ENSO timescales are roughly 4-7 years. We know that PDO timescales are closer to 20 years, and the timescale of mesoscale eddies the Hawaiian Island archipelago are 3 - 6 months. It’s important to keep in mind that in this analysis we are not directly relating any of these processes to the observed sea levels at the tide gauges, but rather we are looking at <em>variability on similar timescales</em>.</p>
<p>Thus, we’re breaking sea level down into:</p>
<p><span class="math notranslate nohighlight">\(\eta = \eta_{tide} + \eta_{t_N} + \eta_{NTR}\)</span></p>
<p>where</p>
<p><span class="math notranslate nohighlight">\(\eta_{NTR} = \eta_{ID} + \eta_{D} + \eta_{S} + \eta_{ItA} + \eta_{InA} + \eta_{W} + \eta_{HF}\)</span></p>
<p>Note that <span class="math notranslate nohighlight">\(\eta_{tide}\)</span> here is accounting for the nodal cycle modulation, and thus it is absent from the non-tidal residuals.</p>
<!-- # make a dictionary of the timescales and the processes
timeframes = {'Interdecadal': '>30 yr cycles', 
              'Decadal': 'e.g. PDO, 8-30 yr', 
              'Seasonal': 'Annual, Semi-Annual, Qtr-Annual',
              'Interannual': 'e.g. ENSO, 1-8 yr', 
              'Intraannual': 'e.g. Mesoscale eddies', 
              'Weekly': '1 week - 2 months', 
              'Storms': '& other short-term variability',
              'Nodal': '18.6 yr tidal modulation'} -->
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>THIS IS VERY MUCH a work in progress and there are bound to be myriad errors.</p>
</div>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> setup.ipynb
<span class="o">%</span><span class="k">run</span> plotting_functions.ipynb
<span class="o">%</span><span class="k">run</span> tseries_functions.py
<span class="kn">from</span> <span class="nn">tide_functions</span> <span class="kn">import</span> <span class="n">calculate_ntr</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/utide/harmonics.py:16: RuntimeWarning: invalid value encountered in cast
  nshallow = np.ma.masked_invalid(const.nshallow).astype(int)
/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/utide/harmonics.py:17: RuntimeWarning: invalid value encountered in cast
  ishallow = np.ma.masked_invalid(const.ishallow).astype(int) - 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>hello
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtain-the-non-tidal-residual-ntr">
<h2>Obtain the Non-tidal Residual (NTR)<a class="headerlink" href="#obtain-the-non-tidal-residual-ntr" title="Permalink to this heading">#</a></h2>
<p>First we’ll estimate the astronomical tides at this location using the selected epoch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;rsl_hawaii.nc&#39;</span><span class="p">)</span>

<span class="c1"># get the ntr for each station</span>
<span class="n">calculate_ntr</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Already processed 20 files:
[50, 52, 61, 57, 552, 52, 59, 25, 57, 552, 38, 25, 38, 58, 58, 59, 50, 60, 61, 60]
Working on station 14: French Frigate
Not enough data for station French Frigate
Working on station 547: Barbers Point, HI
Not enough data for station Barbers Point, HI
Working on station 548: Kaumalapau, HI
Not enough data for station Kaumalapau, HI
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load ntr data</span>
<span class="n">station</span> <span class="o">=</span> <span class="mi">50</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing station&#39;</span><span class="p">,</span> <span class="n">station</span><span class="p">)</span>
<span class="n">station_name</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">station_name</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">record_id</span><span class="o">=</span><span class="n">station</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Station name:&#39;</span><span class="p">,</span> <span class="n">station_name</span><span class="p">)</span>
<span class="n">mhhw</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">MHHW</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">record_id</span><span class="o">=</span><span class="n">station</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">mllw</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">MLLW</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">record_id</span><span class="o">=</span><span class="n">station</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">ntrpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ntr_data/ntr_</span><span class="si">{</span><span class="n">station</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">.csv&#39;</span>


<span class="n">ntr_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="n">ntrpath</span><span class="p">),</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1">#inspect it, does it look sane?</span>
<span class="n">ntr_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Doing station 50
Station name: Midway
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>ntr</th>
      <th>sea_level</th>
      <th>tide</th>
      <th>nodal</th>
      <th>ntr_withNodal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1947-02-08 04:00:00</td>
      <td>219.991209</td>
      <td>1189.0</td>
      <td>969.008791</td>
      <td>-12.397006</td>
      <td>207.594203</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1947-02-08 05:00:00</td>
      <td>255.132164</td>
      <td>1250.0</td>
      <td>994.867836</td>
      <td>-16.478207</td>
      <td>238.653958</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1947-02-08 06:00:00</td>
      <td>267.260455</td>
      <td>1250.0</td>
      <td>982.739545</td>
      <td>-18.188605</td>
      <td>249.071850</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1947-02-08 07:00:00</td>
      <td>284.731082</td>
      <td>1219.0</td>
      <td>934.268918</td>
      <td>-18.475715</td>
      <td>266.255367</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1947-02-08 08:00:00</td>
      <td>293.956199</td>
      <td>1158.0</td>
      <td>864.043801</td>
      <td>-18.088657</td>
      <td>275.867542</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>683583</th>
      <td>2025-01-31 19:00:00</td>
      <td>22.369370</td>
      <td>1317.0</td>
      <td>1294.630630</td>
      <td>8.408938</td>
      <td>30.778308</td>
    </tr>
    <tr>
      <th>683584</th>
      <td>2025-01-31 20:00:00</td>
      <td>10.499296</td>
      <td>1240.0</td>
      <td>1229.500704</td>
      <td>11.343860</td>
      <td>21.843156</td>
    </tr>
    <tr>
      <th>683585</th>
      <td>2025-01-31 21:00:00</td>
      <td>6.865975</td>
      <td>1159.0</td>
      <td>1152.134025</td>
      <td>12.839269</td>
      <td>19.705243</td>
    </tr>
    <tr>
      <th>683586</th>
      <td>2025-01-31 22:00:00</td>
      <td>-1.348111</td>
      <td>1080.0</td>
      <td>1081.348111</td>
      <td>12.557502</td>
      <td>11.209391</td>
    </tr>
    <tr>
      <th>683587</th>
      <td>2025-01-31 23:00:00</td>
      <td>-11.071445</td>
      <td>1025.0</td>
      <td>1036.071445</td>
      <td>10.556340</td>
      <td>-0.515105</td>
    </tr>
  </tbody>
</table>
<p>683588 rows × 6 columns</p>
</div></div></div>
</div>
<section id="plot-and-inspect">
<h3>Plot and Inspect<a class="headerlink" href="#plot-and-inspect" title="Permalink to this heading">#</a></h3>
<p>We’re looking at the NTR with and without the nodal modulation removed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot time series</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr_withNodal&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NTR with Nodal Cycle&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NTR&#39;</span><span class="p">)</span>

<span class="c1"># plt.plot(ntr_data[&#39;time&#39;], ntr_data[&#39;nodal&#39;], label=&#39;Nodal Cycle&#39;)</span>

<span class="c1"># add title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Non-tidal residuals: &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Non-tidal residuals&#39;</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1">#set x-axis to 2000-2005</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2017-01-01&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x15fd31e80&gt;
</pre></div>
</div>
<img alt="../_images/1ca46accc4571bce6a9f8df42af18fa02e66b006a4bf8c8c9ca2a60f78f63b7f.png" src="../_images/1ca46accc4571bce6a9f8df42af18fa02e66b006a4bf8c8c9ca2a60f78f63b7f.png" />
</div>
</div>
</section>
<section id="let-s-examine-the-nodal-modulation-a-bit-more">
<h3>Let’s examine the Nodal modulation a bit more<a class="headerlink" href="#let-s-examine-the-nodal-modulation-a-bit-more" title="Permalink to this heading">#</a></h3>
<p>As noted by others studying the Honolulu tide gauge (e.g. Thompson et al), the modulation of the nodal cycle on the 99th percentile water levels can affect high sea levels by up to 5cm. In low-lying areas this contribution can be significant. Here, we’ll simulate this effect by taking the upper envelope of the monthly max of the nodal modulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Let&#39;s try treating the nodal cycle  in terms of its envelope - we&#39;ll use the Hilbert transform for this</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>

<span class="n">nodal</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;nodal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># set index to time</span>
<span class="n">nodal</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="c1"># resample nodal to monthly on the max</span>
<span class="n">nodal_upper_envelope</span> <span class="o">=</span> <span class="n">nodal</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="c1"># </span>
<span class="c1"># # Obtain the upper envelope of the nodal cycle using the amplitude of the Hilbert transform</span>
<span class="n">analytic_signal</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hilbert</span><span class="p">(</span><span class="n">nodal_upper_envelope</span><span class="p">)</span>
<span class="n">envelope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">analytic_signal</span><span class="p">)</span>

<span class="n">envelope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">envelope</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">nodal_upper_envelope</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Shift the envelope </span>

<span class="c1"># resample the envelope back to ntr_data time index</span>
<span class="c1"># envelope = envelope.reindex(ntr_data[&#39;time&#39;], method=&#39;ffill&#39;)</span>
<span class="c1"># envelope = envelope.shift(periods=1, freq=&#39;15d&#39;)  # shift by 12 hours to align with the data</span>

<span class="c1"># interpolate the envelope to the ntr_data time index</span>
<span class="n">envelope</span> <span class="o">=</span> <span class="n">envelope</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the nodal signal and the envelope</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;nodal&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Nodal Cycle&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">envelope</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper Envelope&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Nodal Cycle Monthly Modulation Upper Envelope: &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#set x-axis to 2017-2018</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2000-01-01&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2024-03-01&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10957.0, 19783.0)
</pre></div>
</div>
<img alt="../_images/5759902570f3023193f93b47ef8108d88ecaf1ae4cdf099cdff81d70c1ffa8bc.png" src="../_images/5759902570f3023193f93b47ef8108d88ecaf1ae4cdf099cdff81d70c1ffa8bc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ntr_data[&#39;time&#39;] = pd.to_datetime(ntr_data[&#39;time&#39;])</span>
<span class="c1"># ntr_data = ntr_data.set_index(&#39;time&#39;)</span>
<span class="c1">#make subset dataframe of ntr data with just ntr and time</span>
<span class="n">sea_level_data</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[[</span><span class="s1">&#39;ntr&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># sea_level_data[&#39;time&#39;] = ntr_data[&#39;time&#39;]</span>
<span class="n">ntr_data_mags</span><span class="p">,</span><span class="n">ntr_trend_series</span><span class="p">,</span><span class="n">ntr_trend_rates</span> <span class="o">=</span> <span class="n">process_trend_with_nan</span><span class="p">(</span><span class="n">sea_level_data</span><span class="p">)</span>
<span class="c1"># sea_level_data</span>
<span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr_detrended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ntr_trend_series</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr_detrended&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NTR detrended&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NTR&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_trend_series</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trend&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># add title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Detrended non-tidal residuals: &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Non-tidal residuals&#39;</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1">#set x-axis to 2001 Jan to Feb</span>
<span class="c1"># plt.xlim([np.datetime64(&#39;2017-10-01&#39;), np.datetime64(&#39;2017-10-02&#39;)])</span>

<span class="c1"># set y-axis to -0.1 to 0.1</span>
<span class="c1"># plt.ylim([0,200])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Non-tidal residuals (millimeters)&#39;)
</pre></div>
</div>
<img alt="../_images/c907e72bc7b3c7d7b5bd065f4246ea593e3133361de7d47999ee8be79e44e2a7.png" src="../_images/c907e72bc7b3c7d7b5bd065f4246ea593e3133361de7d47999ee8be79e44e2a7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now start to filter for each frequency band we want</span>

<span class="c1"># make time_diffs in hours</span>
<span class="n">time_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[h]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">widthSeasonal</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">365.25</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span> <span class="c1">#1 cycle per decade</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # print the length of each segment and the start and end times</span>
<span class="c1"># for i in range(len(segments)):</span>
<span class="c1">#     print(f&#39;Segment {i}: {len(segments[i])} points, {segments[i].time.iloc[0]} to {segments[i].time.iloc[-1]}&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># filtered_segments = filter_segments(segments,value_column=&#39;ntr_detrended&#39;,freq_cutoff=1/(365.25*20),order=4)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The timescales probably need some refinement. For example: mesoscale processes. Higher the latitude the longer the period!!</p>
</div>
<p>From Chen, S., and B. Qiu (2010), Mesoscale eddies northeast of the Hawaiian archipelago from satellite altimeter observations, J. Geophys. Res., 115, C03016, doi:10.1029/2009JC005698</p>
<p>“We define dominant periods of the mesoscale eddy activity by locating the periods at which the spectral peaks within the mesoscale range of 90–180 days. This definition is crude yet robust for the subregions with sharp spectral peaks like the 24°N–27°N, 160°W–155°W one (130 days) and the 18°N–21°N, 170°W–165°W one (90 days), but is also applicable to other subregions. In the lee of the island of Hawaii, 90 day oscillations dominate the mesoscale eddy activity. In the subregions between 24°N and 30°N, a 130 day peak often prevails, but in the 30°N–33°N band, a weak 180 day peak emerges. The pattern is that the higher the latitude, the longer the dominant period.”</p>
<p>Also:
Firing, Y. L., and M. A. Merrifield (2004), Extreme sea level events at Hawaii: Influence of mesoscale eddies, Geophys. Res. Lett., 31, L24306, doi:10.1029/2004GL021539.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define timescales (in days)</span>
<span class="n">annual</span> <span class="o">=</span> <span class="mf">365.25</span>
<span class="n">semiannual</span> <span class="o">=</span> <span class="mf">365.25</span><span class="o">/</span><span class="mi">2</span>
<span class="n">qtrannual</span> <span class="o">=</span> <span class="mf">365.25</span><span class="o">/</span><span class="mi">4</span>
<span class="n">weekly</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">bimonthly</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">365.25</span><span class="o">/</span><span class="mi">12</span>
<span class="n">decadal</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="mf">365.25</span>
<span class="n">interdecadal</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="mf">365.25</span>


<span class="c1"># make a dictionary of the timescales and the processes</span>
<span class="n">timeframes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;30 yr cycles&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Decadal&#39;</span><span class="p">:</span> <span class="s1">&#39;e.g. PDO, 8-30 yr&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Seasonal&#39;</span><span class="p">:</span> <span class="s1">&#39;Annual, Semi-Annual, Qtr-Annual&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Interannual&#39;</span><span class="p">:</span> <span class="s1">&#39;e.g. ENSO, 1-8 yr&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Intraannual&#39;</span><span class="p">:</span> <span class="s1">&#39;e.g. Mesoscale eddies&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Weekly&#39;</span><span class="p">:</span> <span class="s1">&#39;1 week - 2 months&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">:</span> <span class="s1">&#39;&amp; other short-term variability&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Nodal&#39;</span><span class="p">:</span> <span class="s1">&#39;18.6 yr tidal modulation&#39;</span><span class="p">}</span>

<span class="c1"># get frequency of annual cycle</span>
<span class="c1"># annual_freq = 1/annual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_ntr</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">):</span>
    <span class="n">ntr_noAnnual</span><span class="p">,</span> <span class="n">ntr_Annual</span> <span class="o">=</span> <span class="n">filter_known_frequency_components</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr_detrended&#39;</span><span class="p">],</span> <span class="n">time_diffs</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">annual</span> <span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">widthSeasonal</span><span class="p">)</span>
    <span class="n">ntr_noSemiAnnual</span><span class="p">,</span> <span class="n">ntr_SemiAnnual</span> <span class="o">=</span> <span class="n">filter_known_frequency_components</span><span class="p">(</span><span class="n">ntr_noAnnual</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">semiannual</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">widthSeasonal</span><span class="p">)</span>
    <span class="n">ntr_noQtrAnnual</span><span class="p">,</span> <span class="n">ntr_QtrAnnual</span> <span class="o">=</span> <span class="n">filter_known_frequency_components</span><span class="p">(</span><span class="n">ntr_noSemiAnnual</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">qtrannual</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">widthSeasonal</span><span class="p">)</span>
    <span class="n">ntr_Seasonal</span> <span class="o">=</span> <span class="n">ntr_Annual</span> <span class="o">+</span> <span class="n">ntr_SemiAnnual</span> <span class="o">+</span> <span class="n">ntr_QtrAnnual</span>

    <span class="c1">#interdecadal</span>
    <span class="n">ntr_interdecadal</span><span class="p">,</span> <span class="n">ntr_highFreq</span> <span class="o">=</span> <span class="n">butterworth_lowpass</span><span class="p">(</span><span class="n">ntr_noQtrAnnual</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">interdecadal</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padtype</span><span class="o">=</span><span class="s1">&#39;even&#39;</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1">#decadal</span>
    <span class="n">ntr_decadal</span><span class="p">,</span> <span class="n">ntr_highFreq</span> <span class="o">=</span> <span class="n">butterworth_lowpass</span><span class="p">(</span><span class="n">ntr_highFreq</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">decadal</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> 

    <span class="c1">#interannual</span>
    <span class="n">ntr_interannual</span><span class="p">,</span> <span class="n">ntr_highFreq</span> <span class="o">=</span> <span class="n">butterworth_lowpass</span><span class="p">(</span><span class="n">ntr_highFreq</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">annual</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># intraannual</span>
    <span class="n">ntr_intraannual</span><span class="p">,</span> <span class="n">ntr_highFreq</span> <span class="o">=</span> <span class="n">butterworth_lowpass</span><span class="p">(</span><span class="n">ntr_highFreq</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">bimonthly</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Remove high frequencies (weekly to hourly)</span>
    <span class="c1"># ntr_weekly is timescales longer than 7 days but less than 1 month</span>
    <span class="n">ntr_weekly</span><span class="p">,</span> <span class="n">ntr_highFreq</span> <span class="o">=</span> <span class="n">butterworth_lowpass</span><span class="p">(</span><span class="n">ntr_highFreq</span><span class="p">,</span> <span class="n">time_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">weekly</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># make dataframe of filtered data</span>
    <span class="n">ntr_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                             <span class="s1">&#39;ntr&#39;</span><span class="p">:</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;ntr_detrended&#39;</span><span class="p">],</span> 
                             <span class="s1">&#39;sea_level&#39;</span><span class="p">:</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;tide&#39;</span><span class="p">:</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;Nodal&#39;</span><span class="p">:</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;nodal&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;Interdecadal&#39;</span><span class="p">:</span> <span class="n">ntr_interdecadal</span><span class="p">,</span> 
                             <span class="s1">&#39;Decadal&#39;</span><span class="p">:</span> <span class="n">ntr_decadal</span><span class="p">,</span> 
                             <span class="s1">&#39;Interannual&#39;</span><span class="p">:</span> <span class="n">ntr_interannual</span><span class="p">,</span> 
                             <span class="s1">&#39;Seasonal&#39;</span><span class="p">:</span> <span class="n">ntr_Seasonal</span><span class="p">,</span> 
                             <span class="s1">&#39;Intraannual&#39;</span><span class="p">:</span> <span class="n">ntr_intraannual</span><span class="p">,</span> 
                             <span class="s1">&#39;Weekly&#39;</span><span class="p">:</span> <span class="n">ntr_weekly</span><span class="p">,</span> 
                             <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">:</span> <span class="n">ntr_highFreq</span><span class="p">})</span>


    <span class="k">return</span> <span class="n">ntr_filtered</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_filtered</span> <span class="o">=</span> <span class="n">filter_ntr</span><span class="p">(</span><span class="n">ntr_data</span><span class="p">)</span>

<span class="c1"># get std of each component</span>
<span class="n">ntr_component_stds</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># remove time from ntr)component_stds</span>
<span class="n">ntr_component_stds</span> <span class="o">=</span> <span class="n">ntr_component_stds</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filled 5 % of data with noise (std = 92.3913).
Filled 5 % of data with noise (std = 90.1718).
Filled 5 % of data with noise (std = 89.0497).
Filled 5 % of data with noise (std = 88.5547).
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save ntr_component_stds to csv</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ntr_data/ntr_</span><span class="si">{</span><span class="n">station</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">_component_stds.csv&#39;</span><span class="p">)</span>
<span class="n">ntr_component_stds</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># look at filtered components of nodal cycle only</span>
<span class="n">nodal_data</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">nodal_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="n">envelope_demeaned</span> <span class="o">=</span> <span class="n">envelope</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">envelope</span><span class="p">)</span>
<span class="n">envelope_demeaned</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">nodal_data</span><span class="o">.</span><span class="n">index</span>
<span class="n">nodal_data</span><span class="p">[</span><span class="s1">&#39;ntr_detrended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">envelope_demeaned</span>
<span class="n">nodal_filtered</span> <span class="o">=</span> <span class="n">filter_ntr</span><span class="p">(</span><span class="n">nodal_data</span><span class="p">)</span>

<span class="c1">#rename &quot;ntr&quot; in nodal_filtered to &quot;nodal upper envelope&quot;</span>
<span class="n">nodal_filtered</span> <span class="o">=</span> <span class="n">nodal_filtered</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ntr&#39;</span><span class="p">:</span> <span class="s1">&#39;nodal envelope&#39;</span><span class="p">})</span>

<span class="n">nodal_component_std</span> <span class="o">=</span> <span class="n">nodal_filtered</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> 
<span class="n">nodal_component_std</span> <span class="o">=</span> <span class="n">nodal_component_std</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filled 0 % of data with noise (std = 5.3384).
Filled 0 % of data with noise (std = 5.3169).
Filled 0 % of data with noise (std = 5.2867).
Filled 0 % of data with noise (std = 5.2863).
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_filtered</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>ntr</th>
      <th>sea_level</th>
      <th>tide</th>
      <th>Nodal</th>
      <th>Interdecadal</th>
      <th>Decadal</th>
      <th>Interannual</th>
      <th>Seasonal</th>
      <th>Intraannual</th>
      <th>Weekly</th>
      <th>Storms &amp; HF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1947-02-08 04:00:00</td>
      <td>121.578035</td>
      <td>1189.0</td>
      <td>969.008791</td>
      <td>-12.397006</td>
      <td>57.938948</td>
      <td>34.792097</td>
      <td>-9.898817</td>
      <td>-10.990150</td>
      <td>9.225626</td>
      <td>12.676075</td>
      <td>27.834256</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1947-02-08 05:00:00</td>
      <td>156.719165</td>
      <td>1250.0</td>
      <td>994.867836</td>
      <td>-16.478207</td>
      <td>57.938514</td>
      <td>34.787641</td>
      <td>-9.923063</td>
      <td>-10.985279</td>
      <td>9.189910</td>
      <td>11.660839</td>
      <td>64.050602</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1947-02-08 06:00:00</td>
      <td>168.847630</td>
      <td>1250.0</td>
      <td>982.739545</td>
      <td>-18.188605</td>
      <td>57.938080</td>
      <td>34.783185</td>
      <td>-9.947308</td>
      <td>-10.980341</td>
      <td>9.154044</td>
      <td>10.614999</td>
      <td>77.284970</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1947-02-08 07:00:00</td>
      <td>186.318432</td>
      <td>1219.0</td>
      <td>934.268918</td>
      <td>-18.475715</td>
      <td>57.937645</td>
      <td>34.778730</td>
      <td>-9.971552</td>
      <td>-10.975337</td>
      <td>9.118029</td>
      <td>9.539262</td>
      <td>95.891655</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1947-02-08 08:00:00</td>
      <td>195.543723</td>
      <td>1158.0</td>
      <td>864.043801</td>
      <td>-18.088657</td>
      <td>57.937211</td>
      <td>34.774274</td>
      <td>-9.995796</td>
      <td>-10.970267</td>
      <td>9.081864</td>
      <td>8.434382</td>
      <td>106.282055</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>683583</th>
      <td>2025-01-31 19:00:00</td>
      <td>43.205167</td>
      <td>1317.0</td>
      <td>1294.630630</td>
      <td>8.408938</td>
      <td>22.578525</td>
      <td>8.705190</td>
      <td>-50.331580</td>
      <td>-11.013509</td>
      <td>101.511221</td>
      <td>-66.727378</td>
      <td>38.482698</td>
    </tr>
    <tr>
      <th>683584</th>
      <td>2025-01-31 20:00:00</td>
      <td>31.335267</td>
      <td>1240.0</td>
      <td>1229.500704</td>
      <td>11.343860</td>
      <td>22.578525</td>
      <td>8.705190</td>
      <td>-50.331580</td>
      <td>-11.008971</td>
      <td>101.511221</td>
      <td>-66.722837</td>
      <td>26.603720</td>
    </tr>
    <tr>
      <th>683585</th>
      <td>2025-01-31 21:00:00</td>
      <td>27.702121</td>
      <td>1159.0</td>
      <td>1152.134025</td>
      <td>12.839269</td>
      <td>22.578525</td>
      <td>8.705190</td>
      <td>-50.331580</td>
      <td>-11.004366</td>
      <td>101.511221</td>
      <td>-66.719176</td>
      <td>22.962307</td>
    </tr>
    <tr>
      <th>683586</th>
      <td>2025-01-31 22:00:00</td>
      <td>19.488210</td>
      <td>1080.0</td>
      <td>1081.348111</td>
      <td>12.557502</td>
      <td>22.578525</td>
      <td>8.705190</td>
      <td>-50.331580</td>
      <td>-10.999694</td>
      <td>101.511221</td>
      <td>-66.716259</td>
      <td>14.740808</td>
    </tr>
    <tr>
      <th>683587</th>
      <td>2025-01-31 23:00:00</td>
      <td>9.765050</td>
      <td>1025.0</td>
      <td>1036.071445</td>
      <td>10.556340</td>
      <td>22.578525</td>
      <td>8.705190</td>
      <td>-50.331580</td>
      <td>-10.994956</td>
      <td>101.511221</td>
      <td>-66.713966</td>
      <td>5.010615</td>
    </tr>
  </tbody>
</table>
<p>683588 rows × 12 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_component_stds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ntr              92.391399
sea_level        152.46451
tide            136.468595
Nodal            11.228485
Interdecadal     23.679396
Decadal          11.448025
Interannual       34.90248
Seasonal         19.707275
Intraannual      43.084135
Weekly           43.831919
Storms &amp; HF      40.587583
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodal_component_std</span>
<span class="n">nodal_corr</span> <span class="o">=</span> <span class="n">nodal_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span><span class="s1">&#39;tide&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="c1">#plot heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">nodal_corr</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Matrix</span><span class="se">\n</span><span class="s1"> of upper nodal envelope components&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Correlation Matrix\n of upper nodal envelope components&#39;)
</pre></div>
</div>
<img alt="../_images/44c263603e2fa12dc8a08dcfdd09dbbbfd602c02aee6691d5f9bfcd94c3231db.png" src="../_images/44c263603e2fa12dc8a08dcfdd09dbbbfd602c02aee6691d5f9bfcd94c3231db.png" />
</div>
</div>
<p>Note that to define the upper envelope we used monthly maxima. So there should be NO correlation in the weekly/storms.</p>
<p>Next, a sanity check to make sure that everything adds up to the right sum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot ntr, then plot summed components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">ntr_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">]</span><span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Decadal&#39;</span><span class="p">]</span><span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Interannual&#39;</span><span class="p">]</span><span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">]</span><span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Intraannual&#39;</span><span class="p">]</span><span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Weekly&#39;</span><span class="p">]</span><span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]</span> <span class="o">+</span>
         <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">])</span>
<span class="c1">#make a dotted 1:1 line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">],</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1:1 line&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">],</span> <span class="n">ntr_sum</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sea Level&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sum of components&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Sum of components&#39;)
</pre></div>
</div>
<img alt="../_images/eff8871f44cd1119af7913fa0c8cd867bddbe3698d619c948ab3d7a3d4a95916.png" src="../_images/eff8871f44cd1119af7913fa0c8cd867bddbe3698d619c948ab3d7a3d4a95916.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#export data</span>
<span class="c1"># ntr_filtered.to_csv(&#39;data/ntr_filtered_059b.csv&#39;, index=False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#make a heatmap plot of correlation between each component</span>
<span class="n">ntr_corr</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span><span class="s1">&#39;tide&#39;</span><span class="p">,</span><span class="s1">&#39;ntr&#39;</span><span class="p">,</span><span class="s1">&#39;Nodal&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># add description to each component in ntr correlation matrix</span>
<span class="n">ntr_corr</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">timeframes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ntr_corr</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">ntr_corr</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">timeframes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ntr_corr</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="c1">#exclude time,sea_level, and tide from the correlation matrix</span>

<span class="c1">#plot heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">ntr_corr</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation between each component&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Correlation between each component&#39;)
</pre></div>
</div>
<img alt="../_images/7e90ab345083d5ebeff045c66fbb3050957e08b6d49217df379bc5611c23987a.png" src="../_images/7e90ab345083d5ebeff045c66fbb3050957e08b6d49217df379bc5611c23987a.png" />
</div>
</div>
<p>Note there is correlation between some of these timeseries, likely due to the filtering process employed in this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the cumulative sum of the components</span>
<span class="n">ntr_cumsum</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="p">[[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">,</span> <span class="s1">&#39;Decadal&#39;</span><span class="p">,</span> <span class="s1">&#39;Interannual&#39;</span><span class="p">,</span> <span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span> <span class="s1">&#39;Intraannual&#39;</span><span class="p">,</span> <span class="s1">&#39;Weekly&#39;</span><span class="p">,</span> <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ntr_cumsum_stds</span> <span class="o">=</span> <span class="n">ntr_cumsum</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">ntr_cumsum_stds</span>
<span class="c1"># make a plot of ntr_filtered and ntr_cumsum</span>
<span class="c1"># fig, ax = plt.subplots(figsize=(12, 6))</span>
<span class="c1"># ntr_filtered.plot(x=&#39;time&#39;, y=[&#39;ntr&#39;], ax=ax, color=[&#39;black&#39;], linewidth=1)</span>
<span class="c1"># ntr_filtered_sums.plot(x=&#39;time&#39;, y=[&#39;Nodal&#39;] +[&#39;&gt; 20 years&#39;], ax=ax, color=&#39;yellow&#39;,linewidth=1, linestyle=&#39;--&#39;)</span>
<span class="c1"># ntr_cumsum.plot(x=&#39;time&#39;, y=[&#39;Nodal&#39;, &#39;&gt; 20 years&#39;], ax=ax, linewidth=1, linestyle=&#39;--&#39;)</span>
<span class="c1"># ntr_cumsum.plot(x=&#39;time&#39;, y=[&#39;Nodal&#39;, &#39;&gt; 20 years&#39;, &#39;10-20 year&#39;, &#39;1-10 year&#39;, &#39;Seasonal&#39;, &#39;1 month - 1 year&#39;, &#39;1 week - 1 month&#39;, &#39;&lt; 1 week&#39;], ax=ax, linewidth=1, linestyle=&#39;--&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Interdecadal    23.679396
Decadal         27.580426
Interannual     43.454701
Seasonal        49.201242
Intraannual     67.496652
Weekly          81.467042
Storms &amp; HF     92.190174
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_filtered</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;time&#39;, &#39;ntr&#39;, &#39;sea_level&#39;, &#39;tide&#39;, &#39;Nodal&#39;, &#39;Interdecadal&#39;, &#39;Decadal&#39;,
       &#39;Interannual&#39;, &#39;Seasonal&#39;, &#39;Intraannual&#39;, &#39;Weekly&#39;, &#39;Storms &amp; HF&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot original vs. filtered signal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Non-Tidal Residuals&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># plt.plot(ntr_filtered[&#39;time&#39;], ntr_filtered[&#39;&gt; 20 years&#39;], label=&#39;$NTR - NTR_{hf}$&#39;, color=&#39;orange&#39;, linewidth=2)</span>

<span class="c1"># ntr_summed = ntr_Annual + ntr_SemiAnnual + ntr_QtrAnnual + ntr_subAnnual + ntr_multiyear + ntr_decadal + ntr_lowFreq + ntr_monthly</span>
<span class="c1"># ntr_summed = ntr_filtered[&#39;Nodal&#39;]+ ntr_filtered[&#39;&gt; 20 years&#39;] + ntr_filtered[&#39;10-20 year&#39;] + ntr_filtered[&#39;1-10 year&#39;] + ntr_filtered[&#39;Seasonal&#39;] + ntr_filtered[&#39;1 month - 1 year&#39;] + ntr_filtered[&#39;1 week - 1 month&#39;] + ntr_filtered[&#39;&lt; 1 week&#39;]</span>

<span class="c1"># plt.plot(ntr_filtered[&#39;time&#39;], ntr_summed, label=&#39;Sum of Filtered Components&#39;, color=&#39;red&#39;, linewidth=1)</span>

<span class="c1"># plt.plot(ntr_filtered[&#39;time&#39;], ntr_filtered[&#39;Nodal&#39;]+ntr_filtered[&#39;nodal_utide&#39;], label=&#39;Nodal&#39;, color=&#39;green&#39;, linewidth=1)</span>
<span class="c1"># plt.plot(ntr_filtered[&#39;time&#39;], ntr_filtered[&#39;&gt; 20 years&#39;], label=&#39;&gt; 20 years&#39;, color=&#39;orange&#39;, linewidth=1)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Decadal&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decadal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Interannual&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Interannual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;Intraannual&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Intraannual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># plt.plot(ntr_filtered[&#39;time&#39;], ntr_filtered[&#39;1 week - 2 month&#39;], label=&#39;1 week - 2 month&#39;, color=&#39;pink&#39;, linewidth=1)</span>
<span class="c1"># plt.plot(ntr_filtered[&#39;time&#39;], ntr_filtered[&#39;&lt; 1 week&#39;], label=&#39;&lt; 1 week&#39;, color=&#39;grey&#39;, linewidth=1)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Non-Tidal Residuals (mm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Filtered Non-Tidal Residuals (Removing High-Frequency (&gt;7 day) Components): &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="c1"># change xlim to zoom in</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;1995-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2020-02-01&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/236e7895d3ba7c316b8f7ccde9d4471b41ef950d2ce5d52790ed587bbccd7658.png" src="../_images/236e7895d3ba7c316b8f7ccde9d4471b41ef950d2ce5d52790ed587bbccd7658.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_component_stds</span>
<span class="c1"># save to csv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ntr              92.391399
sea_level        152.46451
tide            136.468595
Nodal            11.228485
Interdecadal     23.679396
Decadal          11.448025
Interannual       34.90248
Seasonal         19.707275
Intraannual      43.084135
Weekly           43.831919
Storms &amp; HF      40.587583
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#make a bar plot of the std of each component</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ntr_component_stds</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ntr_component_stds</span><span class="p">)</span>
<span class="n">wrapped_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ntr_component_stds</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ntr_component_stds</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="n">wrapped_labels</span><span class="p">)</span>
<span class="c1"># plt.xticks(rotation=45)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Non-Tidal Residual Components&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Standard Deviation (mm)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Standard Deviation of Non-Tidal Residual Components: &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7b3b0b871e0e494eb6d943bb5edccdff32155888263ffa511b076a4d6fa750e4.png" src="../_images/7b3b0b871e0e494eb6d943bb5edccdff32155888263ffa511b076a4d6fa750e4.png" />
</div>
</div>
</section>
</section>
<section id="plot-components">
<h2>Plot components<a class="headerlink" href="#plot-components" title="Permalink to this heading">#</a></h2>
<p>Make a bar plot of average contributions to water levels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot stacked bars</span>
<span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ntr_cumsum_stds</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="s1">&#39;Components&#39;</span><span class="p">,</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">ntr_cumsum_stds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ntr_cumsum_stds</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>

<span class="c1"># ax.bar(&#39;Total NTR&#39;, np.std(ntr_filled), color=&#39;white&#39;, edgecolor=&#39;black&#39;, linewidth=1)</span>

<span class="c1"># Labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (4$\sigma$, cm)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Non-Tidal Residual </span><span class="se">\n</span><span class="s1">Components by Frequency </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="c1"># plt.xticks(rotation=45)</span>
<span class="c1"># plt.grid(axis=&#39;y&#39;, linestyle=&#39;--&#39;, alpha=0.7)</span>

<span class="c1"># no box</span>
<span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">figName</span> <span class="o">=</span> <span class="s1">&#39;NTR_components_stds&#39;</span> <span class="o">+</span> <span class="n">station_name</span>
<span class="n">glue</span><span class="p">(</span><span class="s1">&#39;NTR_components_stds&#39;</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/qp/nn19rcjs5bdcdvxmff5bd3pr0000gn/T/ipykernel_8324/3394451137.py:7: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  ax.bar(&#39;Components&#39;, 0.4*ntr_cumsum_stds[i], bottom=0, label=ntr_cumsum_stds.index[i].replace(&#39;\n&#39;, &#39; &#39;))
</pre></div>
</div>
<img alt="../_images/e0d0a122c6d88581283e43bf2b9550963117938fffde5adbe134538d9dafd7ac.png" src="../_images/e0d0a122c6d88581283e43bf2b9550963117938fffde5adbe134538d9dafd7ac.png" />
</div>
</div>
<p>It’s important to note that in the plot above, we’re looking at the <span class="math notranslate nohighlight">\(4\sigma\)</span>, which is akin to ‘significant wave height.’ Nor do we consider each <span class="math notranslate nohighlight">\(\sigma\)</span> independently in this plot, but instead we compute the standard deviation of the combined signals, as we work our way up to higher and higher frequencies. For example, the purple line above shows the contributions of any cycles that occur on timescales longer than 1 year. Each individual componenent has its own standard deviation but none are truly indepedent signals (due to the filtering mechanism here) and therefore the variances cannot be directly added together to represent the total variances of the whole signal. (See the correlation plot above.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get dates of extreme events</span>
<span class="n">station_name_1st</span> <span class="o">=</span> <span class="n">station_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">top10tableName</span> <span class="o">=</span> <span class="s1">&#39;SL_top_10_table_&#39;</span> <span class="o">+</span> <span class="n">station_name_1st</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>

<span class="c1">#temporarily set the output_dir to ../output</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../output&#39;</span><span class="p">)</span>
<span class="n">extremes_csv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">top10tableName</span><span class="p">)</span>
<span class="n">extremes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">extremes_csv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extremes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rank</th>
      <th>Highest</th>
      <th>Highest Date</th>
      <th>Highest ONI Mode</th>
      <th>Lowest</th>
      <th>Lowest Date</th>
      <th>Lowest ONI Mode</th>
      <th>Zone</th>
      <th>ONI max</th>
      <th>ONI min</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.747</td>
      <td>2011-01-14 20:00</td>
      <td>La Nina</td>
      <td>-0.638</td>
      <td>1997-05-24 22:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>-1.42</td>
      <td>1.22</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0.732</td>
      <td>2019-12-29 19:00</td>
      <td>Neutral</td>
      <td>-0.635</td>
      <td>1997-04-24 23:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>0.50</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0.720</td>
      <td>2005-01-16 07:00</td>
      <td>El Nino</td>
      <td>-0.627</td>
      <td>1996-03-24 00:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>0.64</td>
      <td>-0.39</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0.680</td>
      <td>1998-02-12 19:00</td>
      <td>El Nino</td>
      <td>-0.616</td>
      <td>1997-06-04 21:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>1.93</td>
      <td>1.22</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0.675</td>
      <td>2018-02-01 18:00</td>
      <td>La Nina</td>
      <td>-0.604</td>
      <td>1997-06-20 21:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>-0.85</td>
      <td>1.60</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>0.655</td>
      <td>2013-12-18 20:00</td>
      <td>Neutral</td>
      <td>-0.597</td>
      <td>1997-07-01 19:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>-0.42</td>
      <td>1.60</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>0.649</td>
      <td>2004-01-11 19:00</td>
      <td>Neutral</td>
      <td>-0.596</td>
      <td>1997-11-18 12:00</td>
      <td>El Nino</td>
      <td>GMT</td>
      <td>0.37</td>
      <td>2.39</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>0.627</td>
      <td>2015-01-20 15:00</td>
      <td>Neutral</td>
      <td>-0.593</td>
      <td>2002-01-29 09:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>0.47</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>0.622</td>
      <td>2000-02-18 15:00</td>
      <td>La Nina</td>
      <td>-0.593</td>
      <td>2005-05-26 22:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>-1.07</td>
      <td>0.11</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>0.614</td>
      <td>2003-01-24 08:00</td>
      <td>El Nino</td>
      <td>-0.589</td>
      <td>1997-04-09 23:00</td>
      <td>Neutral</td>
      <td>GMT</td>
      <td>0.63</td>
      <td>0.28</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extremes_highest</span> <span class="o">=</span> <span class="n">extremes</span><span class="p">[</span><span class="s1">&#39;Highest Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">extremes_lowest</span> <span class="o">=</span> <span class="n">extremes</span><span class="p">[</span><span class="s1">&#39;Lowest Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">extremes_highest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">extremes_highest</span><span class="p">)</span>
<span class="n">extremes_lowest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">extremes_lowest</span><span class="p">)</span>

<span class="n">extremes_highest</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2011-01-14 20:00:00&#39;, &#39;2019-12-29 19:00:00&#39;,
               &#39;2005-01-16 07:00:00&#39;, &#39;1998-02-12 19:00:00&#39;,
               &#39;2018-02-01 18:00:00&#39;, &#39;2013-12-18 20:00:00&#39;,
               &#39;2004-01-11 19:00:00&#39;, &#39;2015-01-20 15:00:00&#39;,
               &#39;2000-02-18 15:00:00&#39;, &#39;2003-01-24 08:00:00&#39;],
              dtype=&#39;datetime64[ns]&#39;, freq=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract these dates from the ntr filtered data</span>
<span class="n">ntr_filtered_extremes_high</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">extremes_highest</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ntr_filtered_extremes_low</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">extremes_lowest</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># get tide data for these dates from ntr_data</span>
<span class="n">tide_data</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span>
<span class="n">ntr_data_extremes_high</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">extremes_highest</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ntr_data_extremes_low</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">extremes_lowest</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># add tide and sea level data to ntr_filtered_extremes_high</span>
<span class="n">ntr_filtered_extremes_high</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_data_extremes_high</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ntr_filtered_extremes_high</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_data_extremes_high</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ntr_filtered_extremes_low</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_data_extremes_low</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ntr_filtered_extremes_low</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_data_extremes_low</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>


<span class="c1"># arrange columns</span>
<span class="n">column_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;ntr&#39;</span><span class="p">,</span> <span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="s1">&#39;tide&#39;</span><span class="p">,</span> <span class="s1">&#39;Nodal&#39;</span><span class="p">,</span> <span class="s1">&#39;Interdecadal&#39;</span><span class="p">,</span> <span class="s1">&#39;Decadal&#39;</span><span class="p">,</span> <span class="s1">&#39;Interannual&#39;</span><span class="p">,</span> <span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span> <span class="s1">&#39;Intraannual&#39;</span><span class="p">,</span> <span class="s1">&#39;Weekly&#39;</span><span class="p">,</span> <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]</span>
<span class="n">ntr_filtered_extremes_high</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="n">column_order</span><span class="p">]</span>
<span class="n">ntr_filtered_extremes_low</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_low</span><span class="p">[</span><span class="n">column_order</span><span class="p">]</span>
<span class="n">ntr_filtered_extremes_high</span>

<span class="c1">#export data</span>
<span class="n">ntr_filtered_extremes_high</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/ntr_filtered_extremes_high_059b.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ntr_filtered_extremes_low</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/ntr_filtered_extremes_low_059b.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_filtered_extremes_high</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>ntr</th>
      <th>sea_level</th>
      <th>tide</th>
      <th>Nodal</th>
      <th>Interdecadal</th>
      <th>Decadal</th>
      <th>Interannual</th>
      <th>Seasonal</th>
      <th>Intraannual</th>
      <th>Weekly</th>
      <th>Storms &amp; HF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>447183</th>
      <td>1998-02-12 19:00:00</td>
      <td>710.818094</td>
      <td>1884.0</td>
      <td>1152.778443</td>
      <td>-0.212692</td>
      <td>-14.615291</td>
      <td>-10.711434</td>
      <td>29.544969</td>
      <td>21.679415</td>
      <td>96.884845</td>
      <td>208.880890</td>
      <td>379.154700</td>
    </tr>
    <tr>
      <th>464843</th>
      <td>2000-02-18 15:00:00</td>
      <td>549.613672</td>
      <td>1826.0</td>
      <td>1259.063599</td>
      <td>8.949944</td>
      <td>-9.006174</td>
      <td>14.662707</td>
      <td>38.777457</td>
      <td>7.554062</td>
      <td>26.969309</td>
      <td>48.430911</td>
      <td>422.225400</td>
    </tr>
    <tr>
      <th>490540</th>
      <td>2003-01-24 08:00:00</td>
      <td>611.643334</td>
      <td>1818.0</td>
      <td>1193.516700</td>
      <td>-15.644105</td>
      <td>-0.835543</td>
      <td>13.772772</td>
      <td>30.301572</td>
      <td>-5.466056</td>
      <td>96.730616</td>
      <td>80.385340</td>
      <td>396.754633</td>
    </tr>
    <tr>
      <th>498999</th>
      <td>2004-01-11 19:00:00</td>
      <td>576.478929</td>
      <td>1853.0</td>
      <td>1265.156752</td>
      <td>12.049090</td>
      <td>1.727593</td>
      <td>2.222940</td>
      <td>4.645230</td>
      <td>16.444757</td>
      <td>114.139843</td>
      <td>191.909134</td>
      <td>245.389432</td>
    </tr>
    <tr>
      <th>507891</th>
      <td>2005-01-16 07:00:00</td>
      <td>749.260303</td>
      <td>1924.0</td>
      <td>1164.926560</td>
      <td>-8.196638</td>
      <td>4.316923</td>
      <td>-9.740215</td>
      <td>25.868135</td>
      <td>15.179877</td>
      <td>70.482304</td>
      <td>320.518903</td>
      <td>322.634376</td>
    </tr>
    <tr>
      <th>560440</th>
      <td>2011-01-14 20:00:00</td>
      <td>807.394334</td>
      <td>1951.0</td>
      <td>1142.959542</td>
      <td>1.966056</td>
      <td>16.536242</td>
      <td>7.656548</td>
      <td>7.862282</td>
      <td>22.590706</td>
      <td>66.273179</td>
      <td>144.724990</td>
      <td>541.750387</td>
    </tr>
    <tr>
      <th>586096</th>
      <td>2013-12-18 20:00:00</td>
      <td>689.556174</td>
      <td>1859.0</td>
      <td>1173.273313</td>
      <td>-16.699959</td>
      <td>19.998555</td>
      <td>9.387919</td>
      <td>-10.208527</td>
      <td>25.753236</td>
      <td>99.864548</td>
      <td>207.008666</td>
      <td>337.751777</td>
    </tr>
    <tr>
      <th>595643</th>
      <td>2015-01-20 15:00:00</td>
      <td>527.641705</td>
      <td>1831.0</td>
      <td>1308.853227</td>
      <td>-3.607441</td>
      <td>20.844550</td>
      <td>4.561598</td>
      <td>-20.519319</td>
      <td>11.721726</td>
      <td>39.121708</td>
      <td>259.272844</td>
      <td>212.638598</td>
    </tr>
    <tr>
      <th>622238</th>
      <td>2018-02-01 18:00:00</td>
      <td>587.312693</td>
      <td>1879.0</td>
      <td>1301.821655</td>
      <td>9.667739</td>
      <td>22.180846</td>
      <td>-2.678453</td>
      <td>12.791808</td>
      <td>-3.074562</td>
      <td>52.320408</td>
      <td>304.022971</td>
      <td>201.749674</td>
    </tr>
    <tr>
      <th>638943</th>
      <td>2019-12-29 19:00:00</td>
      <td>619.593766</td>
      <td>1936.0</td>
      <td>1329.454718</td>
      <td>9.901046</td>
      <td>22.481975</td>
      <td>-1.973597</td>
      <td>-29.021446</td>
      <td>24.117712</td>
      <td>21.733794</td>
      <td>267.881767</td>
      <td>314.373562</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">sl_extreme</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">dates_to_plot</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">date_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates_to_plot</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>
<span class="n">data_on_date</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dates_to_plot</span><span class="p">]</span>

<span class="c1"># Extract the components</span>
<span class="n">components</span> <span class="o">=</span> <span class="n">column_order</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<span class="n">component_values</span> <span class="o">=</span> <span class="n">data_on_date</span><span class="p">[</span><span class="n">components</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">x_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">))</span>  <span class="c1"># Positions for each component</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;width_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="c1"># assign 1 color to each component. There are XX components, so we need XX colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)))</span>


<span class="c1">### --- TOP LEFT PLOT: Bar Chart --- ###</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># First row, first column</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_positions</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">component_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_positions</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># Title and labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Components on &#39;</span> <span class="o">+</span> <span class="n">date_str</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Contribution to </span><span class="se">\n</span><span class="s1">Non-Tidal Residuals (cm)&#39;</span><span class="p">)</span>

<span class="c1"># Add dotted line at 0</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Resize subplot width</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
<span class="c1"># ax.set_position([box.x0, box.y0, box.width * 0.5, box.height])  # Shrink width to 75%</span>

<span class="c1">### --- TOP RIGHT PLOT: NTR &amp; Weekly Trends --- ###</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># First row, second column</span>

<span class="c1"># Filter data to ±10 days around `dates_to_plot`</span>
<span class="n">plusTime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;50d&#39;</span><span class="p">)</span>
<span class="n">timespan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">dates_to_plot</span> <span class="o">-</span> <span class="n">plusTime</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">dates_to_plot</span> <span class="o">+</span> <span class="n">plusTime</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>

<span class="c1"># Ensure time is a datetime index</span>
<span class="n">data_on_date</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">timespan</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_on_date</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot NTR and Weekly trends</span>
<span class="c1"># ax.plot(data_on_date.index, 0.1*data_on_date[&#39;ntr&#39;], label=&#39;NTR&#39;, color=&#39;black&#39;, linewidth=0.5)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data_on_date</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="c1">#only do for columns that aren&#39;t tide or sea level</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span><span class="s1">&#39;tide&#39;</span><span class="p">,</span><span class="s1">&#39;NTR&#39;</span><span class="p">,</span><span class="s1">&#39;ntr&#39;</span><span class="p">,</span><span class="s1">&#39;Nodal&#39;</span><span class="p">,</span><span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]:</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_on_date</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">data_on_date</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">col_index</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">:</span> <span class="c1">#put on the bottom</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_on_date</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">data_on_date</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">col_index</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dates_to_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1">#ensure x-axis is readable</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DayLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DayLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">timespan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timespan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;NTR Components&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="c1">### --- BOTTOM PLOT: Sea Level, Tide, and Interannual --- ###</span>
<span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Filter data to ±100 days around `dates_to_plot`</span>
<span class="n">plusTime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;100d&#39;</span><span class="p">)</span>
<span class="n">timespan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">dates_to_plot</span> <span class="o">-</span> <span class="n">plusTime</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">dates_to_plot</span> <span class="o">+</span> <span class="n">plusTime</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>

<span class="c1"># Ensure time is a datetime index</span>
<span class="n">data_on_date</span> <span class="o">=</span> <span class="n">ntr_filtered</span><span class="p">[</span><span class="n">ntr_filtered</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">timespan</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_on_date</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot sea level, tide, and interannual trend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_on_date</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">data_on_date</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mhhw</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sea Level&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_on_date</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">data_on_date</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mhhw</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tide&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$RSL_</span><span class="si">{MHHW}</span><span class="s1">$ (cm)&#39;</span><span class="p">)</span>

<span class="c1"># Add legend and vertical line</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># add circle at the date and height</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dates_to_plot</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">sl_extreme</span><span class="o">-</span><span class="n">mhhw</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">sl_extreme</span><span class="o">-</span><span class="n">mhhw</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> cm&#39;</span><span class="p">,</span> 
             <span class="p">(</span><span class="n">dates_to_plot</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">sl_extreme</span><span class="o">-</span><span class="n">mhhw</span><span class="p">)),</span> 
             <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span> 
             <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> 
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dates_to_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Set x-axis limits</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">timespan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timespan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Observed and Predicted Sea Level&#39;</span><span class="p">)</span>

<span class="c1"># add title to entire figure</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Non-Tidal Residuals and Sea Level at &#39;</span> <span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39; on &#39;</span> <span class="o">+</span> <span class="n">date_str</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/37c474e290d0e3072893c54d8eb8dff318119a33a0b96f945c24e7e09ad53f54.png" src="../_images/37c474e290d0e3072893c54d8eb8dff318119a33a0b96f945c24e7e09ad53f54.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We need to treat the tide component differently here to get a better comparison</span>
<span class="c1"># get the daily high tides</span>
<span class="n">tide_data</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span>
<span class="n">tide_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ntr_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="n">tide_max_daily</span> <span class="o">=</span> <span class="n">tide_data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">tide_max_daily_std</span> <span class="o">=</span> <span class="n">tide_max_daily</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">tide_min_daily</span> <span class="o">=</span> <span class="n">tide_data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">tide_min_daily_std</span> <span class="o">=</span> <span class="n">tide_min_daily</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_filtered_extremes_high</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>ntr</th>
      <th>sea_level</th>
      <th>tide</th>
      <th>Nodal</th>
      <th>Interdecadal</th>
      <th>Decadal</th>
      <th>Interannual</th>
      <th>Seasonal</th>
      <th>Intraannual</th>
      <th>Weekly</th>
      <th>Storms &amp; HF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>447183</th>
      <td>1998-02-12 19:00:00</td>
      <td>710.818094</td>
      <td>1884.0</td>
      <td>1152.778443</td>
      <td>-0.212692</td>
      <td>-14.615291</td>
      <td>-10.711434</td>
      <td>29.544969</td>
      <td>21.679415</td>
      <td>96.884845</td>
      <td>208.880890</td>
      <td>379.154700</td>
    </tr>
    <tr>
      <th>464843</th>
      <td>2000-02-18 15:00:00</td>
      <td>549.613672</td>
      <td>1826.0</td>
      <td>1259.063599</td>
      <td>8.949944</td>
      <td>-9.006174</td>
      <td>14.662707</td>
      <td>38.777457</td>
      <td>7.554062</td>
      <td>26.969309</td>
      <td>48.430911</td>
      <td>422.225400</td>
    </tr>
    <tr>
      <th>490540</th>
      <td>2003-01-24 08:00:00</td>
      <td>611.643334</td>
      <td>1818.0</td>
      <td>1193.516700</td>
      <td>-15.644105</td>
      <td>-0.835543</td>
      <td>13.772772</td>
      <td>30.301572</td>
      <td>-5.466056</td>
      <td>96.730616</td>
      <td>80.385340</td>
      <td>396.754633</td>
    </tr>
    <tr>
      <th>498999</th>
      <td>2004-01-11 19:00:00</td>
      <td>576.478929</td>
      <td>1853.0</td>
      <td>1265.156752</td>
      <td>12.049090</td>
      <td>1.727593</td>
      <td>2.222940</td>
      <td>4.645230</td>
      <td>16.444757</td>
      <td>114.139843</td>
      <td>191.909134</td>
      <td>245.389432</td>
    </tr>
    <tr>
      <th>507891</th>
      <td>2005-01-16 07:00:00</td>
      <td>749.260303</td>
      <td>1924.0</td>
      <td>1164.926560</td>
      <td>-8.196638</td>
      <td>4.316923</td>
      <td>-9.740215</td>
      <td>25.868135</td>
      <td>15.179877</td>
      <td>70.482304</td>
      <td>320.518903</td>
      <td>322.634376</td>
    </tr>
    <tr>
      <th>560440</th>
      <td>2011-01-14 20:00:00</td>
      <td>807.394334</td>
      <td>1951.0</td>
      <td>1142.959542</td>
      <td>1.966056</td>
      <td>16.536242</td>
      <td>7.656548</td>
      <td>7.862282</td>
      <td>22.590706</td>
      <td>66.273179</td>
      <td>144.724990</td>
      <td>541.750387</td>
    </tr>
    <tr>
      <th>586096</th>
      <td>2013-12-18 20:00:00</td>
      <td>689.556174</td>
      <td>1859.0</td>
      <td>1173.273313</td>
      <td>-16.699959</td>
      <td>19.998555</td>
      <td>9.387919</td>
      <td>-10.208527</td>
      <td>25.753236</td>
      <td>99.864548</td>
      <td>207.008666</td>
      <td>337.751777</td>
    </tr>
    <tr>
      <th>595643</th>
      <td>2015-01-20 15:00:00</td>
      <td>527.641705</td>
      <td>1831.0</td>
      <td>1308.853227</td>
      <td>-3.607441</td>
      <td>20.844550</td>
      <td>4.561598</td>
      <td>-20.519319</td>
      <td>11.721726</td>
      <td>39.121708</td>
      <td>259.272844</td>
      <td>212.638598</td>
    </tr>
    <tr>
      <th>622238</th>
      <td>2018-02-01 18:00:00</td>
      <td>587.312693</td>
      <td>1879.0</td>
      <td>1301.821655</td>
      <td>9.667739</td>
      <td>22.180846</td>
      <td>-2.678453</td>
      <td>12.791808</td>
      <td>-3.074562</td>
      <td>52.320408</td>
      <td>304.022971</td>
      <td>201.749674</td>
    </tr>
    <tr>
      <th>638943</th>
      <td>2019-12-29 19:00:00</td>
      <td>619.593766</td>
      <td>1936.0</td>
      <td>1329.454718</td>
      <td>9.901046</td>
      <td>22.481975</td>
      <td>-1.973597</td>
      <td>-29.021446</td>
      <td>24.117712</td>
      <td>21.733794</td>
      <td>267.881767</td>
      <td>314.373562</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_relative_component_amps</span><span class="p">(</span><span class="n">ntr_filtered_extremes_high</span><span class="p">,</span> <span class="n">ntr_component_stds</span><span class="p">,</span> <span class="n">mhhw</span><span class="p">,</span> <span class="n">tide_max_daily_std</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the relative amplitude of each component in the non-tidal residuals.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - ntr_filtered_extremes_high: pd.DataFrame, filtered non-tidal residuals for extreme high sea level events</span>
<span class="sd">    - ntr_component_stds: pd.Series, standard deviations of each component</span>
<span class="sd">    - mhhw: float, mean higher high water value</span>
<span class="sd">    - tide_max_daily_std: float, standard deviation of daily high tides</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - ntr_filtered_extremes_high_relative_to_std: pd.DataFrame, relative amplitudes of each component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make a copy of the filtered extremes</span>
    <span class="n">extremes_high_relative_to_std</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># get the relative amplitude of the tide component</span>
    <span class="n">extremes_high_relative_to_std</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mhhw</span><span class="p">)</span><span class="o">/</span><span class="n">tide_max_daily_std</span> 
    <span class="n">extremes_high_relative_to_std</span> <span class="o">=</span> <span class="n">extremes_high_relative_to_std</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">])</span>

    <span class="c1"># for each component, divide by the std</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">extremes_high_relative_to_std</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
        <span class="n">extremes_high_relative_to_std</span><span class="p">[</span><span class="n">component</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="p">[</span><span class="n">component</span><span class="p">]</span> <span class="o">/</span> <span class="n">ntr_component_stds</span><span class="p">[</span><span class="n">component</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">extremes_high_relative_to_std</span>

<span class="n">extremes_high_relative_to_std</span> <span class="o">=</span> <span class="n">get_relative_component_amps</span><span class="p">(</span><span class="n">ntr_filtered_extremes_high</span><span class="p">,</span> <span class="n">ntr_component_stds</span><span class="p">,</span> <span class="n">mhhw</span><span class="p">,</span> <span class="n">tide_max_daily_std</span><span class="p">)</span>
<span class="n">extremes_low_relative_to_std</span> <span class="o">=</span> <span class="n">get_relative_component_amps</span><span class="p">(</span><span class="n">ntr_filtered_extremes_low</span><span class="p">,</span> <span class="n">ntr_component_stds</span><span class="p">,</span> <span class="n">mllw</span><span class="p">,</span> <span class="n">tide_min_daily_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_component_amps</span><span class="p">(</span><span class="n">extremes_low_relative_to_std</span><span class="p">,</span> <span class="n">high_or_low</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">station_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>

    <span class="c1"># Create heatmap figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1">#drop the time column and turn it into the index</span>
    <span class="n">extremes_high_relative_to_std_subset</span> <span class="o">=</span> <span class="n">extremes_low_relative_to_std</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>  <span class="c1"># Dark blue at -3</span>
              <span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.45</span><span class="p">)),</span> <span class="c1"># Light blue at -1</span>
              <span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)),</span>  <span class="c1"># White at 0</span>
              <span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.55</span><span class="p">)),</span> <span class="c1"># Light red at 1</span>
              <span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))]</span>  <span class="c1"># Dark red at 3</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># Assigning key points in data range</span>

    <span class="c1"># Create a new colormap</span>
    <span class="n">new_cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;modified_coolwarm&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)),</span> <span class="n">colors</span><span class="p">)))</span>

    <span class="c1"># Keep a **linear scale** but use the modified colormap</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Plot heatmap</span>
    <span class="k">if</span> <span class="n">high_or_low</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span>
        <span class="c1">#order by highest to lowest sea level</span>
        <span class="n">extremes_high_relative_to_std_subset</span> <span class="o">=</span> <span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">high_or_low</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span>
        <span class="n">extremes_high_relative_to_std_subset</span> <span class="o">=</span> <span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># drop sea level column</span>
    <span class="n">extremes_high_relative_to_std_subset</span> <span class="o">=</span> <span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">])</span>

    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">new_cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

    <span class="c1"># label rows and columns</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extremes_high_relative_to_std_subset</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">extremes_high_relative_to_std_subset</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># add colorbar, should be same height as heatmap</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Relative Amplitude</span><span class="se">\n</span><span class="s1"> (Standard Deviations)&#39;</span><span class="p">)</span>

    <span class="c1"># if high_or_low is high, then &quot;Highest&quot;</span>
    <span class="k">if</span> <span class="n">high_or_low</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Extreme High Sea Level Events:</span><span class="se">\n</span><span class="s1">Relative Amplitudes of Non-Tidal Residual Components</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">high_or_low</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Extreme Low Sea Level Events:</span><span class="se">\n</span><span class="s1">Relative Amplitudes of Non-Tidal Residual Components</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_component_amps</span><span class="p">(</span><span class="n">extremes_low_relative_to_std</span><span class="p">,</span> <span class="n">high_or_low</span> <span class="o">=</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="n">station_name</span> <span class="o">=</span> <span class="n">station_name</span><span class="p">)</span>

<span class="c1"># save to output</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;SL_rankings_NTR_relative_amplitudes_top10_</span><span class="si">{</span><span class="n">station_name</span><span class="si">}</span><span class="s1">_low.png&#39;</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/32f4c9354f33bdac068275740d6c41e4dbefbf5c12d5c9c96059e27e8e248e39.png" src="../_images/32f4c9354f33bdac068275740d6c41e4dbefbf5c12d5c9c96059e27e8e248e39.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_component_amps</span><span class="p">(</span><span class="n">extremes_high_relative_to_std</span><span class="p">,</span> <span class="n">high_or_low</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="n">station_name</span> <span class="o">=</span> <span class="n">station_name</span><span class="p">)</span>
<span class="c1"># save to output</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;SL_rankings_NTR_relative_amplitudes_top10_</span><span class="si">{</span><span class="n">station_name</span><span class="si">}</span><span class="s1">_high.png&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>../output/SL_rankings_NTR_relative_amplitudes_top10_Midway_high.png
</pre></div>
</div>
<img alt="../_images/1f30b270a75f400557876884c41c16783cd519ae203ce12d9540d280b59b7d58.png" src="../_images/1f30b270a75f400557876884c41c16783cd519ae203ce12d9540d280b59b7d58.png" />
</div>
</div>
</section>
<section id="make-a-table">
<h2>Make a Table<a class="headerlink" href="#make-a-table" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we&#39;ll make a nice readable table of the highest and lowest sea level events and their components</span>
<span class="c1"># It should be ntr_filtered_extremes_high with the extremes_high_relative_to_std in parentheses</span>

<span class="c1"># make a copy of ntr_filtered_extremes_high</span>
<span class="n">extremes_table</span> <span class="o">=</span> <span class="n">ntr_filtered_extremes_high</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># make it relative to mhhw</span>
<span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mhhw</span>
<span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;tide&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mhhw</span>

<span class="c1"># print out only :.2f </span>
<span class="n">extremes_table</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#rank according to sea level</span>
<span class="n">extremes_table</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">extremes_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>ntr</th>
      <th>sea_level</th>
      <th>tide</th>
      <th>Nodal</th>
      <th>Interdecadal</th>
      <th>Decadal</th>
      <th>Interannual</th>
      <th>Seasonal</th>
      <th>Intraannual</th>
      <th>Weekly</th>
      <th>Storms &amp; HF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>560440</th>
      <td>2011-01-14 20:00:00</td>
      <td>807.39</td>
      <td>747.0</td>
      <td>-61.04</td>
      <td>1.97</td>
      <td>16.54</td>
      <td>7.66</td>
      <td>7.86</td>
      <td>22.59</td>
      <td>66.27</td>
      <td>144.72</td>
      <td>541.75</td>
    </tr>
    <tr>
      <th>638943</th>
      <td>2019-12-29 19:00:00</td>
      <td>619.59</td>
      <td>732.0</td>
      <td>125.45</td>
      <td>9.90</td>
      <td>22.48</td>
      <td>-1.97</td>
      <td>-29.02</td>
      <td>24.12</td>
      <td>21.73</td>
      <td>267.88</td>
      <td>314.37</td>
    </tr>
    <tr>
      <th>507891</th>
      <td>2005-01-16 07:00:00</td>
      <td>749.26</td>
      <td>720.0</td>
      <td>-39.07</td>
      <td>-8.20</td>
      <td>4.32</td>
      <td>-9.74</td>
      <td>25.87</td>
      <td>15.18</td>
      <td>70.48</td>
      <td>320.52</td>
      <td>322.63</td>
    </tr>
    <tr>
      <th>447183</th>
      <td>1998-02-12 19:00:00</td>
      <td>710.82</td>
      <td>680.0</td>
      <td>-51.22</td>
      <td>-0.21</td>
      <td>-14.62</td>
      <td>-10.71</td>
      <td>29.54</td>
      <td>21.68</td>
      <td>96.88</td>
      <td>208.88</td>
      <td>379.15</td>
    </tr>
    <tr>
      <th>622238</th>
      <td>2018-02-01 18:00:00</td>
      <td>587.31</td>
      <td>675.0</td>
      <td>97.82</td>
      <td>9.67</td>
      <td>22.18</td>
      <td>-2.68</td>
      <td>12.79</td>
      <td>-3.07</td>
      <td>52.32</td>
      <td>304.02</td>
      <td>201.75</td>
    </tr>
    <tr>
      <th>586096</th>
      <td>2013-12-18 20:00:00</td>
      <td>689.56</td>
      <td>655.0</td>
      <td>-30.73</td>
      <td>-16.70</td>
      <td>20.00</td>
      <td>9.39</td>
      <td>-10.21</td>
      <td>25.75</td>
      <td>99.86</td>
      <td>207.01</td>
      <td>337.75</td>
    </tr>
    <tr>
      <th>498999</th>
      <td>2004-01-11 19:00:00</td>
      <td>576.48</td>
      <td>649.0</td>
      <td>61.16</td>
      <td>12.05</td>
      <td>1.73</td>
      <td>2.22</td>
      <td>4.65</td>
      <td>16.44</td>
      <td>114.14</td>
      <td>191.91</td>
      <td>245.39</td>
    </tr>
    <tr>
      <th>595643</th>
      <td>2015-01-20 15:00:00</td>
      <td>527.64</td>
      <td>627.0</td>
      <td>104.85</td>
      <td>-3.61</td>
      <td>20.84</td>
      <td>4.56</td>
      <td>-20.52</td>
      <td>11.72</td>
      <td>39.12</td>
      <td>259.27</td>
      <td>212.64</td>
    </tr>
    <tr>
      <th>464843</th>
      <td>2000-02-18 15:00:00</td>
      <td>549.61</td>
      <td>622.0</td>
      <td>55.06</td>
      <td>8.95</td>
      <td>-9.01</td>
      <td>14.66</td>
      <td>38.78</td>
      <td>7.55</td>
      <td>26.97</td>
      <td>48.43</td>
      <td>422.23</td>
    </tr>
    <tr>
      <th>490540</th>
      <td>2003-01-24 08:00:00</td>
      <td>611.64</td>
      <td>614.0</td>
      <td>-10.48</td>
      <td>-15.64</td>
      <td>-0.84</td>
      <td>13.77</td>
      <td>30.30</td>
      <td>-5.47</td>
      <td>96.73</td>
      <td>80.39</td>
      <td>396.75</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check if extremes table everything from interdecadal to storms &amp; hf added equals ntr</span>
<span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Decadal&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Interannual&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Intraannual&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Weekly&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">extremes_table</span><span class="p">[</span><span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]</span>
<span class="c1">#print both columns</span>
<span class="n">extremes_table</span><span class="p">[[</span><span class="s1">&#39;ntr&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ntr</th>
      <th>sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>560440</th>
      <td>807.39</td>
      <td>807.39</td>
    </tr>
    <tr>
      <th>638943</th>
      <td>619.59</td>
      <td>619.59</td>
    </tr>
    <tr>
      <th>507891</th>
      <td>749.26</td>
      <td>749.26</td>
    </tr>
    <tr>
      <th>447183</th>
      <td>710.82</td>
      <td>710.80</td>
    </tr>
    <tr>
      <th>622238</th>
      <td>587.31</td>
      <td>587.31</td>
    </tr>
    <tr>
      <th>586096</th>
      <td>689.56</td>
      <td>689.55</td>
    </tr>
    <tr>
      <th>498999</th>
      <td>576.48</td>
      <td>576.48</td>
    </tr>
    <tr>
      <th>595643</th>
      <td>527.64</td>
      <td>527.63</td>
    </tr>
    <tr>
      <th>464843</th>
      <td>549.61</td>
      <td>549.61</td>
    </tr>
    <tr>
      <th>490540</th>
      <td>611.64</td>
      <td>611.63</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make time the index</span>
<span class="c1"># extremes_table = extremes_table.set_index(&#39;time&#39;)</span>

<span class="c1">#change everything except time column to cm</span>
<span class="n">extremes_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="mf">0.1</span>

<span class="c1">#format time to be more readable</span>
<span class="c1"># extremes_table[&#39;time&#39;] = extremes_table[&#39;time&#39;].dt.strftime(&#39;%Y-%m-%d %H:%M&#39;)</span>

<span class="c1"># round to 2 decimal places</span>
<span class="n">extremes_table</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">extremes_table</span>
<span class="c1"># remove sum column</span>
<span class="n">extremes_table</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

<span class="c1"># put sea_level in first column</span>
<span class="n">extremes_table</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span><span class="s1">&#39;tide&#39;</span><span class="p">,</span><span class="s1">&#39;ntr&#39;</span><span class="p">,</span><span class="s1">&#39;Nodal&#39;</span><span class="p">,</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">,</span><span class="s1">&#39;Decadal&#39;</span><span class="p">,</span><span class="s1">&#39;Interannual&#39;</span><span class="p">,</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span><span class="s1">&#39;Intraannual&#39;</span><span class="p">,</span><span class="s1">&#39;Weekly&#39;</span><span class="p">,</span><span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extremes_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>sea_level</th>
      <th>tide</th>
      <th>ntr</th>
      <th>Nodal</th>
      <th>Interdecadal</th>
      <th>Decadal</th>
      <th>Interannual</th>
      <th>Seasonal</th>
      <th>Intraannual</th>
      <th>Weekly</th>
      <th>Storms &amp; HF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>560440</th>
      <td>2011-01-14 20:00:00</td>
      <td>74.7</td>
      <td>-6.1</td>
      <td>80.7</td>
      <td>0.2</td>
      <td>1.7</td>
      <td>0.8</td>
      <td>0.8</td>
      <td>2.3</td>
      <td>6.6</td>
      <td>14.5</td>
      <td>54.2</td>
    </tr>
    <tr>
      <th>638943</th>
      <td>2019-12-29 19:00:00</td>
      <td>73.2</td>
      <td>12.5</td>
      <td>62.0</td>
      <td>1.0</td>
      <td>2.2</td>
      <td>-0.2</td>
      <td>-2.9</td>
      <td>2.4</td>
      <td>2.2</td>
      <td>26.8</td>
      <td>31.4</td>
    </tr>
    <tr>
      <th>507891</th>
      <td>2005-01-16 07:00:00</td>
      <td>72.0</td>
      <td>-3.9</td>
      <td>74.9</td>
      <td>-0.8</td>
      <td>0.4</td>
      <td>-1.0</td>
      <td>2.6</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>32.1</td>
      <td>32.3</td>
    </tr>
    <tr>
      <th>447183</th>
      <td>1998-02-12 19:00:00</td>
      <td>68.0</td>
      <td>-5.1</td>
      <td>71.1</td>
      <td>-0.0</td>
      <td>-1.5</td>
      <td>-1.1</td>
      <td>3.0</td>
      <td>2.2</td>
      <td>9.7</td>
      <td>20.9</td>
      <td>37.9</td>
    </tr>
    <tr>
      <th>622238</th>
      <td>2018-02-01 18:00:00</td>
      <td>67.5</td>
      <td>9.8</td>
      <td>58.7</td>
      <td>1.0</td>
      <td>2.2</td>
      <td>-0.3</td>
      <td>1.3</td>
      <td>-0.3</td>
      <td>5.2</td>
      <td>30.4</td>
      <td>20.2</td>
    </tr>
    <tr>
      <th>586096</th>
      <td>2013-12-18 20:00:00</td>
      <td>65.5</td>
      <td>-3.1</td>
      <td>69.0</td>
      <td>-1.7</td>
      <td>2.0</td>
      <td>0.9</td>
      <td>-1.0</td>
      <td>2.6</td>
      <td>10.0</td>
      <td>20.7</td>
      <td>33.8</td>
    </tr>
    <tr>
      <th>498999</th>
      <td>2004-01-11 19:00:00</td>
      <td>64.9</td>
      <td>6.1</td>
      <td>57.6</td>
      <td>1.2</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>0.5</td>
      <td>1.6</td>
      <td>11.4</td>
      <td>19.2</td>
      <td>24.5</td>
    </tr>
    <tr>
      <th>595643</th>
      <td>2015-01-20 15:00:00</td>
      <td>62.7</td>
      <td>10.5</td>
      <td>52.8</td>
      <td>-0.4</td>
      <td>2.1</td>
      <td>0.5</td>
      <td>-2.1</td>
      <td>1.2</td>
      <td>3.9</td>
      <td>25.9</td>
      <td>21.3</td>
    </tr>
    <tr>
      <th>464843</th>
      <td>2000-02-18 15:00:00</td>
      <td>62.2</td>
      <td>5.5</td>
      <td>55.0</td>
      <td>0.9</td>
      <td>-0.9</td>
      <td>1.5</td>
      <td>3.9</td>
      <td>0.8</td>
      <td>2.7</td>
      <td>4.8</td>
      <td>42.2</td>
    </tr>
    <tr>
      <th>490540</th>
      <td>2003-01-24 08:00:00</td>
      <td>61.4</td>
      <td>-1.0</td>
      <td>61.2</td>
      <td>-1.6</td>
      <td>-0.1</td>
      <td>1.4</td>
      <td>3.0</td>
      <td>-0.5</td>
      <td>9.7</td>
      <td>8.0</td>
      <td>39.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clear</span> <span class="n">formatted_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now combine extremes_table with extremes_high_relative_to_std</span>
<span class="n">extremes_table_relative</span> <span class="o">=</span> <span class="n">extremes_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">extremes_table_relative</span> <span class="o">=</span> <span class="n">extremes_table_relative</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">std_table</span> <span class="o">=</span> <span class="n">extremes_high_relative_to_std</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">std_table</span> <span class="o">=</span> <span class="n">std_table</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="c1">#sort both on sea_level</span>
<span class="n">extremes_table_relative</span> <span class="o">=</span> <span class="n">extremes_table_relative</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">std_table</span> <span class="o">=</span> <span class="n">std_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">extremes_table_relative</span>

<span class="c1"># Find common columns</span>
<span class="n">common_columns</span> <span class="o">=</span> <span class="n">extremes_table_relative</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">std_table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Select only common columns from both tables</span>
<span class="n">extremes_common</span> <span class="o">=</span> <span class="n">extremes_table_relative</span><span class="p">[</span><span class="n">common_columns</span><span class="p">]</span>
<span class="n">std_common</span> <span class="o">=</span> <span class="n">std_table</span><span class="p">[</span><span class="n">common_columns</span><span class="p">]</span>

<span class="c1"># Rename std columns to make them distinct</span>
<span class="n">std_common</span> <span class="o">=</span> <span class="n">std_common</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_std&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">common_columns</span><span class="p">})</span>

<span class="c1"># Interleave columns (merge column-by-column)</span>
<span class="n">interleaved_columns</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">extremes_common</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">std_common</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="p">())</span>  <span class="c1"># Creates interleaved column order</span>

<span class="c1"># Combine the tables, ensuring interleaved order</span>
<span class="n">formatted_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">extremes_common</span><span class="p">,</span> <span class="n">std_common</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">interleaved_columns</span><span class="p">)]</span>

<span class="c1"># Add back &#39;sea_level&#39; and &#39;ntr&#39; at the front</span>
<span class="n">formatted_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">extremes_table_relative</span><span class="p">[[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="s1">&#39;ntr&#39;</span><span class="p">]],</span> <span class="n">formatted_table</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#drop sea_level_std column</span>
<span class="n">formatted_table</span> <span class="o">=</span> <span class="n">formatted_table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sea_level_std&#39;</span><span class="p">,</span><span class="s1">&#39;sea_level&#39;</span><span class="p">])</span>

<span class="c1"># add &#39;sea level&#39; column back in front</span>
<span class="n">formatted_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="n">extremes_table_relative</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">])</span>

<span class="c1"># format all to 1 decimal place</span>
<span class="n">formatted_table</span> <span class="o">=</span> <span class="n">formatted_table</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">formatted_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sea_level</th>
      <th>ntr</th>
      <th>tide</th>
      <th>tide_std</th>
      <th>Nodal</th>
      <th>Nodal_std</th>
      <th>Interdecadal</th>
      <th>Interdecadal_std</th>
      <th>Decadal</th>
      <th>Decadal_std</th>
      <th>Interannual</th>
      <th>Interannual_std</th>
      <th>Seasonal</th>
      <th>Seasonal_std</th>
      <th>Intraannual</th>
      <th>Intraannual_std</th>
      <th>Weekly</th>
      <th>Weekly_std</th>
      <th>Storms &amp; HF</th>
      <th>Storms &amp; HF_std</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-14 20:00:00</th>
      <td>74.7</td>
      <td>80.7</td>
      <td>-6.1</td>
      <td>-0.7</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>1.7</td>
      <td>0.7</td>
      <td>0.8</td>
      <td>0.7</td>
      <td>0.8</td>
      <td>0.2</td>
      <td>2.3</td>
      <td>1.1</td>
      <td>6.6</td>
      <td>1.5</td>
      <td>14.5</td>
      <td>3.3</td>
      <td>54.2</td>
      <td>13.3</td>
    </tr>
    <tr>
      <th>2019-12-29 19:00:00</th>
      <td>73.2</td>
      <td>62.0</td>
      <td>12.5</td>
      <td>1.5</td>
      <td>1.0</td>
      <td>0.9</td>
      <td>2.2</td>
      <td>0.9</td>
      <td>-0.2</td>
      <td>-0.2</td>
      <td>-2.9</td>
      <td>-0.8</td>
      <td>2.4</td>
      <td>1.2</td>
      <td>2.2</td>
      <td>0.5</td>
      <td>26.8</td>
      <td>6.1</td>
      <td>31.4</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>2005-01-16 07:00:00</th>
      <td>72.0</td>
      <td>74.9</td>
      <td>-3.9</td>
      <td>-0.5</td>
      <td>-0.8</td>
      <td>-0.7</td>
      <td>0.4</td>
      <td>0.2</td>
      <td>-1.0</td>
      <td>-0.9</td>
      <td>2.6</td>
      <td>0.7</td>
      <td>1.5</td>
      <td>0.8</td>
      <td>7.0</td>
      <td>1.6</td>
      <td>32.1</td>
      <td>7.3</td>
      <td>32.3</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>1998-02-12 19:00:00</th>
      <td>68.0</td>
      <td>71.1</td>
      <td>-5.1</td>
      <td>-0.6</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-1.5</td>
      <td>-0.6</td>
      <td>-1.1</td>
      <td>-0.9</td>
      <td>3.0</td>
      <td>0.8</td>
      <td>2.2</td>
      <td>1.1</td>
      <td>9.7</td>
      <td>2.2</td>
      <td>20.9</td>
      <td>4.8</td>
      <td>37.9</td>
      <td>9.3</td>
    </tr>
    <tr>
      <th>2018-02-01 18:00:00</th>
      <td>67.5</td>
      <td>58.7</td>
      <td>9.8</td>
      <td>1.1</td>
      <td>1.0</td>
      <td>0.9</td>
      <td>2.2</td>
      <td>0.9</td>
      <td>-0.3</td>
      <td>-0.2</td>
      <td>1.3</td>
      <td>0.4</td>
      <td>-0.3</td>
      <td>-0.2</td>
      <td>5.2</td>
      <td>1.2</td>
      <td>30.4</td>
      <td>6.9</td>
      <td>20.2</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2013-12-18 20:00:00</th>
      <td>65.5</td>
      <td>69.0</td>
      <td>-3.1</td>
      <td>-0.4</td>
      <td>-1.7</td>
      <td>-1.5</td>
      <td>2.0</td>
      <td>0.8</td>
      <td>0.9</td>
      <td>0.8</td>
      <td>-1.0</td>
      <td>-0.3</td>
      <td>2.6</td>
      <td>1.3</td>
      <td>10.0</td>
      <td>2.3</td>
      <td>20.7</td>
      <td>4.7</td>
      <td>33.8</td>
      <td>8.3</td>
    </tr>
    <tr>
      <th>2004-01-11 19:00:00</th>
      <td>64.9</td>
      <td>57.6</td>
      <td>6.1</td>
      <td>0.7</td>
      <td>1.2</td>
      <td>1.1</td>
      <td>0.2</td>
      <td>0.1</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>0.5</td>
      <td>0.1</td>
      <td>1.6</td>
      <td>0.8</td>
      <td>11.4</td>
      <td>2.6</td>
      <td>19.2</td>
      <td>4.4</td>
      <td>24.5</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>2015-01-20 15:00:00</th>
      <td>62.7</td>
      <td>52.8</td>
      <td>10.5</td>
      <td>1.2</td>
      <td>-0.4</td>
      <td>-0.3</td>
      <td>2.1</td>
      <td>0.9</td>
      <td>0.5</td>
      <td>0.4</td>
      <td>-2.1</td>
      <td>-0.6</td>
      <td>1.2</td>
      <td>0.6</td>
      <td>3.9</td>
      <td>0.9</td>
      <td>25.9</td>
      <td>5.9</td>
      <td>21.3</td>
      <td>5.2</td>
    </tr>
    <tr>
      <th>2000-02-18 15:00:00</th>
      <td>62.2</td>
      <td>55.0</td>
      <td>5.5</td>
      <td>0.6</td>
      <td>0.9</td>
      <td>0.8</td>
      <td>-0.9</td>
      <td>-0.4</td>
      <td>1.5</td>
      <td>1.3</td>
      <td>3.9</td>
      <td>1.1</td>
      <td>0.8</td>
      <td>0.4</td>
      <td>2.7</td>
      <td>0.6</td>
      <td>4.8</td>
      <td>1.1</td>
      <td>42.2</td>
      <td>10.4</td>
    </tr>
    <tr>
      <th>2003-01-24 08:00:00</th>
      <td>61.4</td>
      <td>61.2</td>
      <td>-1.0</td>
      <td>-0.1</td>
      <td>-1.6</td>
      <td>-1.4</td>
      <td>-0.1</td>
      <td>-0.0</td>
      <td>1.4</td>
      <td>1.2</td>
      <td>3.0</td>
      <td>0.9</td>
      <td>-0.5</td>
      <td>-0.3</td>
      <td>9.7</td>
      <td>2.2</td>
      <td>8.0</td>
      <td>1.8</td>
      <td>39.7</td>
      <td>9.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#make a pretty pdf of the table with great_tables</span>
<span class="kn">from</span> <span class="nn">great_tables</span> <span class="kn">import</span> <span class="n">GT</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">loc</span>

<span class="c1"># make time a column again</span>
<span class="n">formatted_table_time</span> <span class="o">=</span> <span class="n">formatted_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1"># make time a string</span>
<span class="n">formatted_table_time</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_table_time</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>

<span class="c1">#change &#39;Storms &amp; HF_std&#39; to &#39;Storms_std&#39;</span>
<span class="n">formatted_table_time</span> <span class="o">=</span> <span class="n">formatted_table_time</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Storms &amp; HF_std&#39;</span><span class="p">:</span> <span class="s1">&#39;Storms_std&#39;</span><span class="p">})</span>

<span class="n">ntr_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">,</span><span class="s1">&#39;Interdecadal_std&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Decadal&#39;</span><span class="p">,</span><span class="s1">&#39;Decadal_std&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Interannual&#39;</span><span class="p">,</span><span class="s1">&#39;Interannual_std&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span><span class="s1">&#39;Seasonal_std&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Intraannual&#39;</span><span class="p">,</span><span class="s1">&#39;Intraannual_std&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Weekly&#39;</span><span class="p">,</span><span class="s1">&#39;Weekly_std&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">,</span><span class="s1">&#39;Storms_std&#39;</span><span class="p">]</span>

<span class="c1"># col_width_dict = #make dictionary using ntr_columns</span>
<span class="n">col_width_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;30px&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ntr_columns</span><span class="p">}</span>
<span class="c1">#add time to col_width_dict</span>
<span class="n">col_width_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;120px&quot;</span>

<span class="n">std_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">formatted_table_time</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;std&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>

<span class="c1"># Create a Table object</span>
<span class="p">(</span>
    <span class="n">GT</span><span class="p">(</span><span class="n">formatted_table_time</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tab_options</span><span class="p">(</span><span class="n">table_font_size</span><span class="o">=</span><span class="s2">&quot;12px&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cols_width</span><span class="p">(</span><span class="n">cases</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span> <span class="p">:</span> <span class="s2">&quot;150px&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">cols_label</span><span class="p">(</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">ntr</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;NTR&#39;</span><span class="p">),</span> <span class="n">sea_level</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Sea Level&#39;</span><span class="p">),</span> <span class="n">tide_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span><span class="n">Interdecadal</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="s1">&#39;Inter-</span><span class="se">\n</span><span class="s1">decadal&#39;</span><span class="p">),</span><span class="n">Interdecadal_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span>
        <span class="n">Decadal_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span><span class="n">Interannual_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span> <span class="n">Interannual</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Inter-</span><span class="se">\n</span><span class="s1">annual&#39;</span><span class="p">),</span>
        <span class="n">Seasonal_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span><span class="n">Intraannual_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span><span class="n">Intraannual</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Intra-</span><span class="se">\n</span><span class="s1">annual&#39;</span><span class="p">),</span>
        <span class="n">Weekly_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span><span class="n">Storms_std</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span><span class="n">Nodal_std</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="s1">&#39;(σ̂)&#39;</span><span class="p">),</span>
        <span class="n">tide</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Tide&#39;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">tab_spanner</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Non-Tidal Residual&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">ntr_columns</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tab_header</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">station_name</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;Top 10 Extreme Sea Level Events and their Non-Tidal Residual Components&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tab_source_note</span><span class="p">(</span>
            <span class="n">source_note</span><span class="o">=</span><span class="s1">&#39;Data are in cm, relative to MHHW. The (σ̂) represents the magnitude of each component relative to its standard deviation.&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tab_source_note</span><span class="p">(</span>
            <span class="n">source_note</span><span class="o">=</span><span class="s1">&#39;Data: &#39;</span> <span class="o">+</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;publisher_url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="s1">&#39;UHSLC Station ID: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>
        <span class="o">.</span><span class="n">fmt_number</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">std_columns</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;(</span><span class="si">{x}</span><span class="s1">)&#39;</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">data_color</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">std_columns</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="idiyyvuxze" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#idiyyvuxze table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#idiyyvuxze thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#idiyyvuxze p { margin: 0; padding: 0; }
 #idiyyvuxze .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 12px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #idiyyvuxze .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #idiyyvuxze .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #idiyyvuxze .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #idiyyvuxze .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #idiyyvuxze .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #idiyyvuxze .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #idiyyvuxze .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #idiyyvuxze .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #idiyyvuxze .gt_column_spanner_outer:first-child { padding-left: 0; }
 #idiyyvuxze .gt_column_spanner_outer:last-child { padding-right: 0; }
 #idiyyvuxze .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #idiyyvuxze .gt_spanner_row { border-bottom-style: hidden; }
 #idiyyvuxze .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #idiyyvuxze .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #idiyyvuxze .gt_from_md> :first-child { margin-top: 0; }
 #idiyyvuxze .gt_from_md> :last-child { margin-bottom: 0; }
 #idiyyvuxze .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #idiyyvuxze .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #idiyyvuxze .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #idiyyvuxze .gt_row_group_first td { border-top-width: 2px; }
 #idiyyvuxze .gt_row_group_first th { border-top-width: 2px; }
 #idiyyvuxze .gt_striped { background-color: rgba(128,128,128,0.05); }
 #idiyyvuxze .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #idiyyvuxze .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #idiyyvuxze .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #idiyyvuxze .gt_left { text-align: left; }
 #idiyyvuxze .gt_center { text-align: center; }
 #idiyyvuxze .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #idiyyvuxze .gt_font_normal { font-weight: normal; }
 #idiyyvuxze .gt_font_bold { font-weight: bold; }
 #idiyyvuxze .gt_font_italic { font-style: italic; }
 #idiyyvuxze .gt_super { font-size: 65%; }
 #idiyyvuxze .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #idiyyvuxze .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table style="table-layout: fixed;" class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
  <col style="width:150px;"/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
</colgroup>

<thead>

  <tr class="gt_heading">
    <td colspan="21" class="gt_heading gt_title gt_font_normal">Midway</td>
  </tr>
  <tr class="gt_heading">
    <td colspan="21" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Top 10 Extreme Sea Level Events and their Non-Tidal Residual Components</td>
  </tr>
<tr class="gt_col_headings gt_spanner_row">
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="Sea Level">Sea Level</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="NTR">NTR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="Tide">Tide</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="Nodal">Nodal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="14" scope="colgroup" id="Non-Tidal Residual">
    <span class="gt_column_spanner">Non-Tidal Residual</span>
  </th>
</tr>
<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Inter-&#10;decadal">Inter-
decadal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Decadal">Decadal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Inter-&#10;annual">Inter-
annual</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Seasonal">Seasonal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Intra-&#10;annual">Intra-
annual</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Weekly">Weekly</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Storms &amp;amp; HF">Storms &amp; HF</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="(σ̂)">(σ̂)</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_right">2011-01-14 20:00</td>
    <td class="gt_row gt_right">74.7</td>
    <td class="gt_row gt_right">80.7</td>
    <td class="gt_row gt_right">-6.1</td>
    <td style="color: #000000; background-color: #d6e7f1;" class="gt_row gt_right">(−0.7)</td>
    <td class="gt_row gt_right">0.2</td>
    <td style="color: #000000; background-color: #f8f0eb;" class="gt_row gt_right">(0.2)</td>
    <td class="gt_row gt_right">1.7</td>
    <td style="color: #000000; background-color: #fcdecd;" class="gt_row gt_right">(0.7)</td>
    <td class="gt_row gt_right">0.8</td>
    <td style="color: #000000; background-color: #fcdecd;" class="gt_row gt_right">(0.7)</td>
    <td class="gt_row gt_right">0.8</td>
    <td style="color: #000000; background-color: #f8f0eb;" class="gt_row gt_right">(0.2)</td>
    <td class="gt_row gt_right">2.3</td>
    <td style="color: #000000; background-color: #fac7ad;" class="gt_row gt_right">(1.1)</td>
    <td class="gt_row gt_right">6.6</td>
    <td style="color: #000000; background-color: #f5ac8b;" class="gt_row gt_right">(1.5)</td>
    <td class="gt_row gt_right">14.5</td>
    <td style="color: #FFFFFF; background-color: #a9152a;" class="gt_row gt_right">(3.3)</td>
    <td class="gt_row gt_right">54.2</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(13.3)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2019-12-29 19:00</td>
    <td class="gt_row gt_right">73.2</td>
    <td class="gt_row gt_right">62.0</td>
    <td class="gt_row gt_right">12.5</td>
    <td style="color: #000000; background-color: #f5ac8b;" class="gt_row gt_right">(1.5)</td>
    <td class="gt_row gt_right">1.0</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">2.2</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">-0.2</td>
    <td style="color: #000000; background-color: #eef2f5;" class="gt_row gt_right">(−0.2)</td>
    <td class="gt_row gt_right">-2.9</td>
    <td style="color: #000000; background-color: #d1e5f0;" class="gt_row gt_right">(−0.8)</td>
    <td class="gt_row gt_right">2.4</td>
    <td style="color: #000000; background-color: #f8c0a5;" class="gt_row gt_right">(1.2)</td>
    <td class="gt_row gt_right">2.2</td>
    <td style="color: #000000; background-color: #fbe6d9;" class="gt_row gt_right">(0.5)</td>
    <td class="gt_row gt_right">26.8</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(6.1)</td>
    <td class="gt_row gt_right">31.4</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(7.7)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2005-01-16 07:00</td>
    <td class="gt_row gt_right">72.0</td>
    <td class="gt_row gt_right">74.9</td>
    <td class="gt_row gt_right">-3.9</td>
    <td style="color: #000000; background-color: #dfecf3;" class="gt_row gt_right">(−0.5)</td>
    <td class="gt_row gt_right">-0.8</td>
    <td style="color: #000000; background-color: #d6e7f1;" class="gt_row gt_right">(−0.7)</td>
    <td class="gt_row gt_right">0.4</td>
    <td style="color: #000000; background-color: #f8f0eb;" class="gt_row gt_right">(0.2)</td>
    <td class="gt_row gt_right">-1.0</td>
    <td style="color: #000000; background-color: #c9e1ee;" class="gt_row gt_right">(−0.9)</td>
    <td class="gt_row gt_right">2.6</td>
    <td style="color: #000000; background-color: #fcdecd;" class="gt_row gt_right">(0.7)</td>
    <td class="gt_row gt_right">1.5</td>
    <td style="color: #000000; background-color: #fddbc7;" class="gt_row gt_right">(0.8)</td>
    <td class="gt_row gt_right">7.0</td>
    <td style="color: #000000; background-color: #f4a582;" class="gt_row gt_right">(1.6)</td>
    <td class="gt_row gt_right">32.1</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(7.3)</td>
    <td class="gt_row gt_right">32.3</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(7.9)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">1998-02-12 19:00</td>
    <td class="gt_row gt_right">68.0</td>
    <td class="gt_row gt_right">71.1</td>
    <td class="gt_row gt_right">-5.1</td>
    <td style="color: #000000; background-color: #daeaf2;" class="gt_row gt_right">(−0.6)</td>
    <td class="gt_row gt_right">-0.0</td>
    <td style="color: #000000; background-color: #f7f7f7;" class="gt_row gt_right">(0.0)</td>
    <td class="gt_row gt_right">-1.5</td>
    <td style="color: #000000; background-color: #daeaf2;" class="gt_row gt_right">(−0.6)</td>
    <td class="gt_row gt_right">-1.1</td>
    <td style="color: #000000; background-color: #c9e1ee;" class="gt_row gt_right">(−0.9)</td>
    <td class="gt_row gt_right">3.0</td>
    <td style="color: #000000; background-color: #fddbc7;" class="gt_row gt_right">(0.8)</td>
    <td class="gt_row gt_right">2.2</td>
    <td style="color: #000000; background-color: #fac7ad;" class="gt_row gt_right">(1.1)</td>
    <td class="gt_row gt_right">9.7</td>
    <td style="color: #000000; background-color: #de715a;" class="gt_row gt_right">(2.2)</td>
    <td class="gt_row gt_right">20.9</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(4.8)</td>
    <td class="gt_row gt_right">37.9</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(9.3)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2018-02-01 18:00</td>
    <td class="gt_row gt_right">67.5</td>
    <td class="gt_row gt_right">58.7</td>
    <td class="gt_row gt_right">9.8</td>
    <td style="color: #000000; background-color: #fac7ad;" class="gt_row gt_right">(1.1)</td>
    <td class="gt_row gt_right">1.0</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">2.2</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">-0.3</td>
    <td style="color: #000000; background-color: #eef2f5;" class="gt_row gt_right">(−0.2)</td>
    <td class="gt_row gt_right">1.3</td>
    <td style="color: #000000; background-color: #fae9df;" class="gt_row gt_right">(0.4)</td>
    <td class="gt_row gt_right">-0.3</td>
    <td style="color: #000000; background-color: #eef2f5;" class="gt_row gt_right">(−0.2)</td>
    <td class="gt_row gt_right">5.2</td>
    <td style="color: #000000; background-color: #f8c0a5;" class="gt_row gt_right">(1.2)</td>
    <td class="gt_row gt_right">30.4</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(6.9)</td>
    <td class="gt_row gt_right">20.2</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(5.0)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2013-12-18 20:00</td>
    <td class="gt_row gt_right">65.5</td>
    <td class="gt_row gt_right">69.0</td>
    <td class="gt_row gt_right">-3.1</td>
    <td style="color: #000000; background-color: #e4eef4;" class="gt_row gt_right">(−0.4)</td>
    <td class="gt_row gt_right">-1.7</td>
    <td style="color: #000000; background-color: #9ac9e0;" class="gt_row gt_right">(−1.5)</td>
    <td class="gt_row gt_right">2.0</td>
    <td style="color: #000000; background-color: #fddbc7;" class="gt_row gt_right">(0.8)</td>
    <td class="gt_row gt_right">0.9</td>
    <td style="color: #000000; background-color: #fddbc7;" class="gt_row gt_right">(0.8)</td>
    <td class="gt_row gt_right">-1.0</td>
    <td style="color: #000000; background-color: #e9f0f4;" class="gt_row gt_right">(−0.3)</td>
    <td class="gt_row gt_right">2.6</td>
    <td style="color: #000000; background-color: #f7b99c;" class="gt_row gt_right">(1.3)</td>
    <td class="gt_row gt_right">10.0</td>
    <td style="color: #000000; background-color: #da6954;" class="gt_row gt_right">(2.3)</td>
    <td class="gt_row gt_right">20.7</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(4.7)</td>
    <td class="gt_row gt_right">33.8</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(8.3)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2004-01-11 19:00</td>
    <td class="gt_row gt_right">64.9</td>
    <td class="gt_row gt_right">57.6</td>
    <td class="gt_row gt_right">6.1</td>
    <td style="color: #000000; background-color: #fcdecd;" class="gt_row gt_right">(0.7)</td>
    <td class="gt_row gt_right">1.2</td>
    <td style="color: #000000; background-color: #fac7ad;" class="gt_row gt_right">(1.1)</td>
    <td class="gt_row gt_right">0.2</td>
    <td style="color: #000000; background-color: #f8f4f1;" class="gt_row gt_right">(0.1)</td>
    <td class="gt_row gt_right">0.2</td>
    <td style="color: #000000; background-color: #f8f0eb;" class="gt_row gt_right">(0.2)</td>
    <td class="gt_row gt_right">0.5</td>
    <td style="color: #000000; background-color: #f8f4f1;" class="gt_row gt_right">(0.1)</td>
    <td class="gt_row gt_right">1.6</td>
    <td style="color: #000000; background-color: #fddbc7;" class="gt_row gt_right">(0.8)</td>
    <td class="gt_row gt_right">11.4</td>
    <td style="color: #000000; background-color: #cd4e45;" class="gt_row gt_right">(2.6)</td>
    <td class="gt_row gt_right">19.2</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(4.4)</td>
    <td class="gt_row gt_right">24.5</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(6.0)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2015-01-20 15:00</td>
    <td class="gt_row gt_right">62.7</td>
    <td class="gt_row gt_right">52.8</td>
    <td class="gt_row gt_right">10.5</td>
    <td style="color: #000000; background-color: #f8c0a5;" class="gt_row gt_right">(1.2)</td>
    <td class="gt_row gt_right">-0.4</td>
    <td style="color: #000000; background-color: #e9f0f4;" class="gt_row gt_right">(−0.3)</td>
    <td class="gt_row gt_right">2.1</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">0.5</td>
    <td style="color: #000000; background-color: #fae9df;" class="gt_row gt_right">(0.4)</td>
    <td class="gt_row gt_right">-2.1</td>
    <td style="color: #000000; background-color: #daeaf2;" class="gt_row gt_right">(−0.6)</td>
    <td class="gt_row gt_right">1.2</td>
    <td style="color: #000000; background-color: #fce2d3;" class="gt_row gt_right">(0.6)</td>
    <td class="gt_row gt_right">3.9</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">25.9</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(5.9)</td>
    <td class="gt_row gt_right">21.3</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(5.2)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2000-02-18 15:00</td>
    <td class="gt_row gt_right">62.2</td>
    <td class="gt_row gt_right">55.0</td>
    <td class="gt_row gt_right">5.5</td>
    <td style="color: #000000; background-color: #fce2d3;" class="gt_row gt_right">(0.6)</td>
    <td class="gt_row gt_right">0.9</td>
    <td style="color: #000000; background-color: #fddbc7;" class="gt_row gt_right">(0.8)</td>
    <td class="gt_row gt_right">-0.9</td>
    <td style="color: #000000; background-color: #e4eef4;" class="gt_row gt_right">(−0.4)</td>
    <td class="gt_row gt_right">1.5</td>
    <td style="color: #000000; background-color: #f7b99c;" class="gt_row gt_right">(1.3)</td>
    <td class="gt_row gt_right">3.9</td>
    <td style="color: #000000; background-color: #fac7ad;" class="gt_row gt_right">(1.1)</td>
    <td class="gt_row gt_right">0.8</td>
    <td style="color: #000000; background-color: #fae9df;" class="gt_row gt_right">(0.4)</td>
    <td class="gt_row gt_right">2.7</td>
    <td style="color: #000000; background-color: #fce2d3;" class="gt_row gt_right">(0.6)</td>
    <td class="gt_row gt_right">4.8</td>
    <td style="color: #000000; background-color: #fac7ad;" class="gt_row gt_right">(1.1)</td>
    <td class="gt_row gt_right">42.2</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(10.4)</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2003-01-24 08:00</td>
    <td class="gt_row gt_right">61.4</td>
    <td class="gt_row gt_right">61.2</td>
    <td class="gt_row gt_right">-1.0</td>
    <td style="color: #000000; background-color: #f2f5f6;" class="gt_row gt_right">(−0.1)</td>
    <td class="gt_row gt_right">-1.6</td>
    <td style="color: #000000; background-color: #a2cde2;" class="gt_row gt_right">(−1.4)</td>
    <td class="gt_row gt_right">-0.1</td>
    <td style="color: #000000; background-color: #f7f7f7;" class="gt_row gt_right">(0.0)</td>
    <td class="gt_row gt_right">1.4</td>
    <td style="color: #000000; background-color: #f8c0a5;" class="gt_row gt_right">(1.2)</td>
    <td class="gt_row gt_right">3.0</td>
    <td style="color: #000000; background-color: #fcd4be;" class="gt_row gt_right">(0.9)</td>
    <td class="gt_row gt_right">-0.5</td>
    <td style="color: #000000; background-color: #e9f0f4;" class="gt_row gt_right">(−0.3)</td>
    <td class="gt_row gt_right">9.7</td>
    <td style="color: #000000; background-color: #de715a;" class="gt_row gt_right">(2.2)</td>
    <td class="gt_row gt_right">8.0</td>
    <td style="color: #000000; background-color: #ed9475;" class="gt_row gt_right">(1.8)</td>
    <td class="gt_row gt_right">39.7</td>
    <td style="color: #000000; background-color: #808080;" class="gt_row gt_right">(9.8)</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="21">Data are in cm, relative to MHHW. The (σ̂) represents the magnitude of each component relative to its standard deviation.</td>
  </tr>


  <tr>
    <td class="gt_sourcenote" colspan="21">Data: UHSLC Fast Delivery Tide Gauge Data (hourly), http://uhslc.soest.hawaii.edu, UHSLC Station ID: 50</td>
  </tr>

</tfoot>

</table>

</div>
        </div></div>
</div>
<p>This table is trying to be the best at both worlds but is probably too complicated. A simpler version:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make time a column again</span>
<span class="n">formatted_table_time</span> <span class="o">=</span> <span class="n">extremes_table_relative</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1"># make time a string</span>
<span class="n">formatted_table_time</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_table_time</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>


<span class="n">ntr_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Decadal&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Interannual&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Intraannual&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Weekly&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Storms &amp; HF&#39;</span><span class="p">]</span>

<span class="c1"># col_width_dict = #make dictionary using ntr_columns</span>
<span class="n">col_width_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;5%&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ntr_columns</span><span class="p">}</span>
<span class="c1">#add time to col_width_dict</span>
<span class="c1"># col_width_dict[&#39;time&#39;] = &quot;120px&quot;</span>

<span class="n">std_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">formatted_table_time</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;std&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>

<span class="n">timeframes_str</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">timeframes</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="c1"># Create a Table object</span>
<span class="p">(</span>
    <span class="n">GT</span><span class="p">(</span><span class="n">formatted_table_time</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tab_options</span><span class="p">(</span><span class="n">table_font_size</span><span class="o">=</span><span class="s2">&quot;13px&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cols_width</span><span class="p">(</span><span class="n">cases</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;150px&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">cols_label</span><span class="p">(</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">ntr</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;NTR&#39;</span><span class="p">),</span> <span class="n">sea_level</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Sea Level&#39;</span><span class="p">),</span> <span class="n">Interdecadal</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="s1">&#39;Inter-</span><span class="se">\n</span><span class="s1">decadal&#39;</span><span class="p">),</span>
        <span class="n">Interannual</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Inter-</span><span class="se">\n</span><span class="s1">annual&#39;</span><span class="p">),</span><span class="n">Intraannual</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Intra-</span><span class="se">\n</span><span class="s1">annual&#39;</span><span class="p">),</span>
        <span class="n">tide</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Tide&#39;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">tab_spanner</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Non-Tidal Residual&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">ntr_columns</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tab_header</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">station_name</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;Top 10 Extreme Sea Level Events and their Non-Tidal Residual Components&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tab_source_note</span><span class="p">(</span>
            <span class="n">source_note</span><span class="o">=</span><span class="s1">&#39;Data are in cm, relative to MHHW. &#39;</span>
            <span class="s1">&#39;The Nodal component shown here is included in the Tide component, representing the nodal modulation of the tide at the given hour. &#39;</span>
            <span class="s1">&#39;The timescales of the NTR components are as follows: &#39;</span> <span class="o">+</span> <span class="n">timeframes_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
            
        <span class="o">.</span><span class="n">tab_source_note</span><span class="p">(</span>
            <span class="n">source_note</span><span class="o">=</span><span class="s1">&#39;Data: &#39;</span> <span class="o">+</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;publisher_url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="s1">&#39;UHSLC Station ID: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>
        <span class="o">.</span><span class="n">fmt_number</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">std_columns</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;(</span><span class="si">{x}</span><span class="s1">)&#39;</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">data_color</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">std_columns</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="uhkswbkgpl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#uhkswbkgpl table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#uhkswbkgpl thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#uhkswbkgpl p { margin: 0; padding: 0; }
 #uhkswbkgpl .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 13px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #uhkswbkgpl .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #uhkswbkgpl .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #uhkswbkgpl .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #uhkswbkgpl .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #uhkswbkgpl .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #uhkswbkgpl .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #uhkswbkgpl .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #uhkswbkgpl .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #uhkswbkgpl .gt_column_spanner_outer:first-child { padding-left: 0; }
 #uhkswbkgpl .gt_column_spanner_outer:last-child { padding-right: 0; }
 #uhkswbkgpl .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #uhkswbkgpl .gt_spanner_row { border-bottom-style: hidden; }
 #uhkswbkgpl .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #uhkswbkgpl .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #uhkswbkgpl .gt_from_md> :first-child { margin-top: 0; }
 #uhkswbkgpl .gt_from_md> :last-child { margin-bottom: 0; }
 #uhkswbkgpl .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #uhkswbkgpl .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #uhkswbkgpl .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #uhkswbkgpl .gt_row_group_first td { border-top-width: 2px; }
 #uhkswbkgpl .gt_row_group_first th { border-top-width: 2px; }
 #uhkswbkgpl .gt_striped { background-color: rgba(128,128,128,0.05); }
 #uhkswbkgpl .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #uhkswbkgpl .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #uhkswbkgpl .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #uhkswbkgpl .gt_left { text-align: left; }
 #uhkswbkgpl .gt_center { text-align: center; }
 #uhkswbkgpl .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #uhkswbkgpl .gt_font_normal { font-weight: normal; }
 #uhkswbkgpl .gt_font_bold { font-weight: bold; }
 #uhkswbkgpl .gt_font_italic { font-style: italic; }
 #uhkswbkgpl .gt_super { font-size: 65%; }
 #uhkswbkgpl .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #uhkswbkgpl .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table style="table-layout: fixed;" class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
  <col style="width:150px;"/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
  <col/>
</colgroup>

<thead>

  <tr class="gt_heading">
    <td colspan="12" class="gt_heading gt_title gt_font_normal">Midway</td>
  </tr>
  <tr class="gt_heading">
    <td colspan="12" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Top 10 Extreme Sea Level Events and their Non-Tidal Residual Components</td>
  </tr>
<tr class="gt_col_headings gt_spanner_row">
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="Sea Level">Sea Level</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="Tide">Tide</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="NTR">NTR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col" id="Nodal">Nodal</th>
  <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="7" scope="colgroup" id="Non-Tidal Residual">
    <span class="gt_column_spanner">Non-Tidal Residual</span>
  </th>
</tr>
<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Inter-&#10;decadal">Inter-
decadal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Decadal">Decadal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Inter-&#10;annual">Inter-
annual</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Seasonal">Seasonal</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Intra-&#10;annual">Intra-
annual</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Weekly">Weekly</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Storms &amp;amp; HF">Storms &amp; HF</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_right">2011-01-14 20:00</td>
    <td class="gt_row gt_right">74.7</td>
    <td class="gt_row gt_right">-6.1</td>
    <td class="gt_row gt_right">80.7</td>
    <td class="gt_row gt_right">0.2</td>
    <td class="gt_row gt_right">1.7</td>
    <td class="gt_row gt_right">0.8</td>
    <td class="gt_row gt_right">0.8</td>
    <td class="gt_row gt_right">2.3</td>
    <td class="gt_row gt_right">6.6</td>
    <td class="gt_row gt_right">14.5</td>
    <td class="gt_row gt_right">54.2</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2019-12-29 19:00</td>
    <td class="gt_row gt_right">73.2</td>
    <td class="gt_row gt_right">12.5</td>
    <td class="gt_row gt_right">62.0</td>
    <td class="gt_row gt_right">1.0</td>
    <td class="gt_row gt_right">2.2</td>
    <td class="gt_row gt_right">-0.2</td>
    <td class="gt_row gt_right">-2.9</td>
    <td class="gt_row gt_right">2.4</td>
    <td class="gt_row gt_right">2.2</td>
    <td class="gt_row gt_right">26.8</td>
    <td class="gt_row gt_right">31.4</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2005-01-16 07:00</td>
    <td class="gt_row gt_right">72.0</td>
    <td class="gt_row gt_right">-3.9</td>
    <td class="gt_row gt_right">74.9</td>
    <td class="gt_row gt_right">-0.8</td>
    <td class="gt_row gt_right">0.4</td>
    <td class="gt_row gt_right">-1.0</td>
    <td class="gt_row gt_right">2.6</td>
    <td class="gt_row gt_right">1.5</td>
    <td class="gt_row gt_right">7.0</td>
    <td class="gt_row gt_right">32.1</td>
    <td class="gt_row gt_right">32.3</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">1998-02-12 19:00</td>
    <td class="gt_row gt_right">68.0</td>
    <td class="gt_row gt_right">-5.1</td>
    <td class="gt_row gt_right">71.1</td>
    <td class="gt_row gt_right">-0.0</td>
    <td class="gt_row gt_right">-1.5</td>
    <td class="gt_row gt_right">-1.1</td>
    <td class="gt_row gt_right">3.0</td>
    <td class="gt_row gt_right">2.2</td>
    <td class="gt_row gt_right">9.7</td>
    <td class="gt_row gt_right">20.9</td>
    <td class="gt_row gt_right">37.9</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2018-02-01 18:00</td>
    <td class="gt_row gt_right">67.5</td>
    <td class="gt_row gt_right">9.8</td>
    <td class="gt_row gt_right">58.7</td>
    <td class="gt_row gt_right">1.0</td>
    <td class="gt_row gt_right">2.2</td>
    <td class="gt_row gt_right">-0.3</td>
    <td class="gt_row gt_right">1.3</td>
    <td class="gt_row gt_right">-0.3</td>
    <td class="gt_row gt_right">5.2</td>
    <td class="gt_row gt_right">30.4</td>
    <td class="gt_row gt_right">20.2</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2013-12-18 20:00</td>
    <td class="gt_row gt_right">65.5</td>
    <td class="gt_row gt_right">-3.1</td>
    <td class="gt_row gt_right">69.0</td>
    <td class="gt_row gt_right">-1.7</td>
    <td class="gt_row gt_right">2.0</td>
    <td class="gt_row gt_right">0.9</td>
    <td class="gt_row gt_right">-1.0</td>
    <td class="gt_row gt_right">2.6</td>
    <td class="gt_row gt_right">10.0</td>
    <td class="gt_row gt_right">20.7</td>
    <td class="gt_row gt_right">33.8</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2004-01-11 19:00</td>
    <td class="gt_row gt_right">64.9</td>
    <td class="gt_row gt_right">6.1</td>
    <td class="gt_row gt_right">57.6</td>
    <td class="gt_row gt_right">1.2</td>
    <td class="gt_row gt_right">0.2</td>
    <td class="gt_row gt_right">0.2</td>
    <td class="gt_row gt_right">0.5</td>
    <td class="gt_row gt_right">1.6</td>
    <td class="gt_row gt_right">11.4</td>
    <td class="gt_row gt_right">19.2</td>
    <td class="gt_row gt_right">24.5</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2015-01-20 15:00</td>
    <td class="gt_row gt_right">62.7</td>
    <td class="gt_row gt_right">10.5</td>
    <td class="gt_row gt_right">52.8</td>
    <td class="gt_row gt_right">-0.4</td>
    <td class="gt_row gt_right">2.1</td>
    <td class="gt_row gt_right">0.5</td>
    <td class="gt_row gt_right">-2.1</td>
    <td class="gt_row gt_right">1.2</td>
    <td class="gt_row gt_right">3.9</td>
    <td class="gt_row gt_right">25.9</td>
    <td class="gt_row gt_right">21.3</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2000-02-18 15:00</td>
    <td class="gt_row gt_right">62.2</td>
    <td class="gt_row gt_right">5.5</td>
    <td class="gt_row gt_right">55.0</td>
    <td class="gt_row gt_right">0.9</td>
    <td class="gt_row gt_right">-0.9</td>
    <td class="gt_row gt_right">1.5</td>
    <td class="gt_row gt_right">3.9</td>
    <td class="gt_row gt_right">0.8</td>
    <td class="gt_row gt_right">2.7</td>
    <td class="gt_row gt_right">4.8</td>
    <td class="gt_row gt_right">42.2</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">2003-01-24 08:00</td>
    <td class="gt_row gt_right">61.4</td>
    <td class="gt_row gt_right">-1.0</td>
    <td class="gt_row gt_right">61.2</td>
    <td class="gt_row gt_right">-1.6</td>
    <td class="gt_row gt_right">-0.1</td>
    <td class="gt_row gt_right">1.4</td>
    <td class="gt_row gt_right">3.0</td>
    <td class="gt_row gt_right">-0.5</td>
    <td class="gt_row gt_right">9.7</td>
    <td class="gt_row gt_right">8.0</td>
    <td class="gt_row gt_right">39.7</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="12">Data are in cm, relative to MHHW. The Nodal component shown here is included in the Tide component, representing the nodal modulation of the tide at the given hour. The timescales of the NTR components are as follows: Interdecadal: &gt;30 yr cycles; Decadal: e.g. PDO, 8-30 yr; Seasonal: Annual, Semi-Annual, Qtr-Annual; Interannual: e.g. ENSO, 1-8 yr; Intraannual: e.g. Mesoscale eddies; Weekly: 1 week - 2 months; Storms &amp; HF: &amp; other short-term variability; Nodal: 18.6 yr tidal modulation.</td>
  </tr>


  <tr>
    <td class="gt_sourcenote" colspan="12">Data: UHSLC Fast Delivery Tide Gauge Data (hourly), http://uhslc.soest.hawaii.edu, UHSLC Station ID: 50</td>
  </tr>

</tfoot>

</table>

</div>
        </div></div>
</div>
</section>
<section id="make-a-map">
<h2>Make a map<a class="headerlink" href="#make-a-map" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s turn our our bar chart into a pie chart</span>
<span class="c1"># we&#39;ll use what we used previously to get the std of each component</span>
<span class="c1"># ntr_cumsum_stds</span>
<span class="c1"># ntr_var = ntr_filtered[&#39;ntr&#39;].var()</span>

<span class="c1"># ntr_component_vars[&#39;covariance&#39;] = ntr_var - sum_ntr_var</span>

<span class="c1"># get the difference between each successive component</span>
<span class="n">ntr_cumsum_diff</span> <span class="o">=</span> <span class="n">ntr_cumsum_stds</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="n">ntr_cumsum_diff</span><span class="p">[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_cumsum_stds</span><span class="p">[</span><span class="s1">&#39;Interdecadal&#39;</span><span class="p">]</span>

<span class="c1">#reverse the order of the components</span>
<span class="c1"># ntr_cumsum_stds = ntr_cumsum_stds[::-1]</span>
<span class="c1"># ntr_component_vars = ntr_component_vars[::-1]</span>

<span class="c1"># # make a pie chart, ignoring co-variance for now because omg</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">ntr_cumsum_diff</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ntr_cumsum_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>
<span class="n">center_circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>  <span class="c1"># Creates a white hole</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">center_circle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.patches.Circle at 0x164e31cd0&gt;
</pre></div>
</div>
<img alt="../_images/db1b8a9eec9a49b9156c1dc0f56cc8386eecc155f02c7079728e0f48e2b07a5f.png" src="../_images/db1b8a9eec9a49b9156c1dc0f56cc8386eecc155f02c7079728e0f48e2b07a5f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a locations dictionary, with stations: (lat, lon)</span>
<span class="c1"># from ds</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">station_id</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">locations</span> <span class="o">=</span> <span class="p">{</span><span class="n">station</span><span class="p">:</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">)}</span>
<span class="n">station_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">station</span><span class="p">:</span> <span class="nb">id</span> <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">station_id</span><span class="p">)}</span>

<span class="c1"># make pie_data dictionary</span>
<span class="n">ntr_component_stds_subset</span> <span class="o">=</span> <span class="n">ntr_component_stds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ntr_component_stds_subset</span> <span class="o">=</span> <span class="n">ntr_component_stds_subset</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span> <span class="s1">&#39;tide&#39;</span><span class="p">])</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">station</span><span class="p">:</span> <span class="n">ntr_component_stds_subset</span> <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">}</span>


<span class="n">locations</span>
<span class="n">station_ids</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;French Frigate&#39;: 14,
 &#39;Funafuti&#39;: 25,
 &quot;Nuku&#39;alofa&quot;: 38,
 &#39;Midway&#39;: 50,
 &#39;Johnston&#39;: 52,
 &#39;Honolulu, Hawaii&#39;: 57,
 &#39;Nawiliwili&#39;: 58,
 &#39;Kahului&#39;: 59,
 &#39;Hilo, Hawaii&#39;: 60,
 &#39;Mokuoloe&#39;: 61,
 &#39;Barbers Point, HI&#39;: 547,
 &#39;Kaumalapau, HI&#39;: 548,
 &#39;Kawaihae&#39;: 552}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a new pie data dictionary that calls from ntr_data/ntr_{station:03d}_component_stds.csv</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ntr_mag</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">station_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">station_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ntr_data/ntr_</span><span class="si">{</span><span class="nb">id</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">_component_stds.csv&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">station_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="c1"># pie_data[station] = zeros the size of ntr_component_stds</span>
        <span class="n">pie_data</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_component_stds</span> <span class="o">*</span> <span class="mi">0</span>
        <span class="k">continue</span>
    <span class="n">station_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">station_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;ntr&#39;</span> <span class="ow">in</span> <span class="n">station_data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">ntr_mag</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;ntr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">station_data</span> <span class="o">=</span> <span class="n">station_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;ntr&#39;</span><span class="p">)</span>
    <span class="c1"># print(station_data)</span>
    <span class="c1"># ntr_mag[station] = station_data[&#39;ntr&#39;]</span>
    <span class="n">station_data</span> <span class="o">=</span> <span class="n">station_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span><span class="s1">&#39;tide&#39;</span><span class="p">])</span>
    <span class="c1"># remove &#39;sea_level&#39; and &#39;tide&#39; columns</span>
    <span class="n">pie_data</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>

<span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>

<span class="c1"># Create figure and axis</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">crs</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>

<span class="n">cmems</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;cmems_L4_SSH_0.125deg_1993_2024.nc&#39;</span><span class="p">)</span>

<span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmems</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cmems</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
<span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmems</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cmems</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
<span class="n">xlims_360</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">360</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xlims</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">xlims_360</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlims_360</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">plot_pie_inset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Convert lat/lon to map display coordinates</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> 
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">pie_ax</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pie_ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>  <span class="c1"># Fully transparent background</span>

    <span class="n">wedges</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">autotexts</span> <span class="o">=</span> <span class="n">pie_ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">140</span><span class="p">,</span> 
                                          <span class="n">wedgeprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
    
    <span class="c1"># pie_ax.pie(data, startangle=140)  # Draw pie chart</span>
    <span class="n">pie_ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">pie_ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">pie_ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Hide frame</span>
    <span class="c1"># add title</span>
    <span class="c1"># pie_ax.set_title(station, fontsize=8)</span>

<span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">pie_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">station</span><span class="p">]</span>
    <span class="c1"># if data is all zeros, skip</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ntr_mag</span><span class="p">[</span><span class="n">station</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">ntr_mag</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="n">plot_pie_inset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Station&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>


<span class="c1">#add grid</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">xlocs</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">(),</span><span class="n">ylocs</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">(),</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
<span class="c1">#make all labels tiny</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>


<span class="c1"># Will need to fix longitude labels!!</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Non-Tidal Residual Component Beachballs by Station&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Non-Tidal Residual Component Beachballs by Station&#39;)
</pre></div>
</div>
<img alt="../_images/7f7262e66bf559d863df0dcc07c3a45675e829612d0c5a8e0b9403e063d39daa.png" src="../_images/7f7262e66bf559d863df0dcc07c3a45675e829612d0c5a8e0b9403e063d39daa.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # make a new pie data dictionary that calls from ntr_data/ntr_{station:03d}_component_stds.csv</span>
<span class="c1"># pie_data = {}</span>

<span class="c1"># make a dataframe of the ntr_component_stds, with each station as a column</span>
<span class="n">ntr_component_stds_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">stations</span><span class="p">)</span>
<span class="c1"># ntr_component_stds_df = ntr_component_stds_df.append(ntr_component_stds, ignore_index=True)</span>
<span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">station_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">station_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ntr_data/ntr_</span><span class="si">{</span><span class="nb">id</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">_component_stds.csv&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">station_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="c1">#         # pie_data[station] = zeros the size of ntr_component_stds</span>
        <span class="n">pie_data</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntr_component_stds</span> <span class="o">*</span> <span class="mi">0</span>
        <span class="k">continue</span>
    <span class="n">station_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">station_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ntr_component_stds_df</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

<span class="c1">#replace nans with 0</span>
<span class="n">ntr_component_stds_df</span> <span class="o">=</span> <span class="n">ntr_component_stds_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">infer_objects</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#change &#39;tide&#39; to &#39;Tide&#39; in index</span>
<span class="n">ntr_component_stds_df</span> <span class="o">=</span> <span class="n">ntr_component_stds_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tide&#39;</span><span class="p">:</span><span class="s1">&#39;Tide&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/qp/nn19rcjs5bdcdvxmff5bd3pr0000gn/T/ipykernel_8324/4155686509.py:17: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option(&#39;future.no_silent_downcasting&#39;, True)`
  ntr_component_stds_df = ntr_component_stds_df.fillna(0).infer_objects(copy=False)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntr_component_stds_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>French Frigate</th>
      <th>Funafuti</th>
      <th>Nuku'alofa</th>
      <th>Midway</th>
      <th>Johnston</th>
      <th>Honolulu, Hawaii</th>
      <th>Nawiliwili</th>
      <th>Kahului</th>
      <th>Hilo, Hawaii</th>
      <th>Mokuoloe</th>
      <th>Barbers Point, HI</th>
      <th>Kaumalapau, HI</th>
      <th>Kawaihae</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ntr</th>
      <td>0</td>
      <td>80.312141</td>
      <td>64.384297</td>
      <td>92.391399</td>
      <td>90.104389</td>
      <td>64.739695</td>
      <td>64.258122</td>
      <td>60.411542</td>
      <td>68.343945</td>
      <td>64.605521</td>
      <td>0</td>
      <td>0</td>
      <td>74.180228</td>
    </tr>
    <tr>
      <th>sea_level</th>
      <td>0</td>
      <td>475.137279</td>
      <td>394.176600</td>
      <td>152.464510</td>
      <td>236.701174</td>
      <td>198.394132</td>
      <td>189.229716</td>
      <td>225.369458</td>
      <td>246.099963</td>
      <td>213.566597</td>
      <td>0</td>
      <td>0</td>
      <td>224.974953</td>
    </tr>
    <tr>
      <th>Tide</th>
      <td>0</td>
      <td>470.282670</td>
      <td>391.562621</td>
      <td>136.468595</td>
      <td>220.644687</td>
      <td>187.029051</td>
      <td>174.155180</td>
      <td>212.208600</td>
      <td>224.409444</td>
      <td>201.699179</td>
      <td>0</td>
      <td>0</td>
      <td>202.782750</td>
    </tr>
    <tr>
      <th>Nodal</th>
      <td>0</td>
      <td>28.348202</td>
      <td>18.821874</td>
      <td>11.228485</td>
      <td>13.271974</td>
      <td>19.701486</td>
      <td>19.573692</td>
      <td>22.850118</td>
      <td>21.995667</td>
      <td>23.273698</td>
      <td>0</td>
      <td>0</td>
      <td>23.837844</td>
    </tr>
    <tr>
      <th>Interdecadal</th>
      <td>0</td>
      <td>0.591677</td>
      <td>17.512991</td>
      <td>23.679396</td>
      <td>9.179115</td>
      <td>6.097591</td>
      <td>10.974042</td>
      <td>3.893542</td>
      <td>9.935847</td>
      <td>6.897386</td>
      <td>0</td>
      <td>0</td>
      <td>20.948970</td>
    </tr>
    <tr>
      <th>Decadal</th>
      <td>0</td>
      <td>16.825801</td>
      <td>28.539358</td>
      <td>11.448025</td>
      <td>9.743551</td>
      <td>19.390535</td>
      <td>17.444609</td>
      <td>20.347854</td>
      <td>23.309874</td>
      <td>18.892987</td>
      <td>0</td>
      <td>0</td>
      <td>31.613721</td>
    </tr>
    <tr>
      <th>Interannual</th>
      <td>0</td>
      <td>49.896996</td>
      <td>31.389328</td>
      <td>34.902480</td>
      <td>37.544738</td>
      <td>32.525634</td>
      <td>31.101024</td>
      <td>31.210778</td>
      <td>31.095158</td>
      <td>31.619452</td>
      <td>0</td>
      <td>0</td>
      <td>35.152178</td>
    </tr>
    <tr>
      <th>Seasonal</th>
      <td>0</td>
      <td>22.225112</td>
      <td>14.593408</td>
      <td>19.707275</td>
      <td>19.554461</td>
      <td>11.180329</td>
      <td>14.572673</td>
      <td>9.963079</td>
      <td>12.728573</td>
      <td>12.078401</td>
      <td>0</td>
      <td>0</td>
      <td>13.386880</td>
    </tr>
    <tr>
      <th>Intraannual</th>
      <td>0</td>
      <td>33.136991</td>
      <td>29.093386</td>
      <td>43.084135</td>
      <td>48.960144</td>
      <td>25.469826</td>
      <td>31.703260</td>
      <td>22.787167</td>
      <td>28.272909</td>
      <td>25.340911</td>
      <td>0</td>
      <td>0</td>
      <td>31.847286</td>
    </tr>
    <tr>
      <th>Weekly</th>
      <td>0</td>
      <td>24.530909</td>
      <td>25.226859</td>
      <td>43.831919</td>
      <td>33.674295</td>
      <td>20.484482</td>
      <td>24.511261</td>
      <td>20.934561</td>
      <td>24.171823</td>
      <td>20.715319</td>
      <td>0</td>
      <td>0</td>
      <td>22.774474</td>
    </tr>
    <tr>
      <th>Storms &amp; HF</th>
      <td>0</td>
      <td>25.693085</td>
      <td>21.490229</td>
      <td>40.587583</td>
      <td>40.297862</td>
      <td>32.969038</td>
      <td>23.568157</td>
      <td>29.575518</td>
      <td>36.238870</td>
      <td>34.477773</td>
      <td>0</td>
      <td>0</td>
      <td>30.601497</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Repeat the map exercise using only the amplitudes of each component at each station, will just be a scatter plot</span>
<span class="kn">from</span> <span class="nn">maps</span> <span class="kn">import</span> <span class="n">plot_thin_map_hawaii</span><span class="p">,</span> <span class="n">get_stationinfo</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>

<span class="n">ntr_component_names</span> <span class="o">=</span> <span class="n">ntr_component_stds_df</span><span class="o">.</span><span class="n">index</span>
<span class="c1">#remove sea level and ntr</span>
<span class="n">ntr_component_names</span> <span class="o">=</span> <span class="n">ntr_component_names</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;sea_level&#39;</span><span class="p">,</span><span class="s1">&#39;ntr&#39;</span><span class="p">])</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ntr_component_names</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">,</span><span class="n">gl</span> <span class="o">=</span> <span class="n">plot_thin_map_hawaii</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ntrmag</span> <span class="o">=</span> <span class="n">ntr_component_stds_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ntr_component_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">ntrmagNorm</span> <span class="o">=</span> <span class="n">ntrmag</span><span class="o">/</span><span class="n">ntrmag</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="o">*</span><span class="n">ntrmagNorm</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ntrmagNorm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    
    <span class="c1"># add label for station name in upper right</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">ntr_component_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    
    <span class="c1">#remove gl labels from interior plots</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">left_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">bottom_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span> == 0:
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#adjust </span>
<span class="c1"># add title</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Relative Amplitude of Tide and NTR Components by Station&#39;</span><span class="p">)</span>

<span class="c1"># suptitle should be higher</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d177ec8ddcd5249b635171e0f95a96d59a44a24f12e67bb7f1f09896213d4709.png" src="../_images/d177ec8ddcd5249b635171e0f95a96d59a44a24f12e67bb7f1f09896213d4709.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "jwfiedler/SL_Hawaii",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="regional_and_local/SL_Extremes_annual.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Annual Extremes</p>
      </div>
    </a>
    <a class="right-next"
       href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Nonstationary Extremes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtain-the-non-tidal-residual-ntr">Obtain the Non-tidal Residual (NTR)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-inspect">Plot and Inspect</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-examine-the-nodal-modulation-a-bit-more">Let’s examine the Nodal modulation a bit more</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-components">Plot components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-a-table">Make a Table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-a-map">Make a map</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Playground Coordinator
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>