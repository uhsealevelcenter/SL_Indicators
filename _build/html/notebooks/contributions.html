

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Contributions &#8212; Hawaii Sea Level Indicators</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/contributions';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Minor Flood Frequency and Duration" href="Flood.html" />
    <link rel="prev" title="Nonstationary Extremes" href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">In development! Please post issues and suggestions to github.</div>
  </div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/trend_map.png" class="logo__image only-light" alt="Hawaii Sea Level Indicators - Home"/>
    <script>document.write(`<img src="../_static/trend_map.png" class="logo__image only-dark" alt="Hawaii Sea Level Indicators - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://uhslc.soest.hawaii.edu/jfiedler/SeaLevelIndicators/">Indicator Matrix</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../gettingStarted.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="SL_Data_Wrangling.html">Data Wrangling</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ANNUAL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="SL_annual.html">Sea Level Magnitude</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Trend.html">Sea Level Trend</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_anomaly_annual.html">Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Rankings_annual.html">Annual Sea Level Rankings</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Extremes_annual.html">Annual Extremes</a></li>
<li class="toctree-l2"><a class="reference internal" href="components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html">Nonstationary Extremes</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Contributions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Flood.html">Minor Flood Frequency and Duration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="FloodFrequency.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="FloodDuration.html">Flood Duration</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">INTRA-ANNUAL</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="SL_intra-annual.html">Sea Level Magnitude</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_anomaly_intra-annual.html">Intra-Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="regional_and_local/SL_Extremes_intra-annual.html">Intra-Annual Extremes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Flood_intra-annual.html">Minor Flood Frequency and Duration</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="FloodFrequency_intra-annual.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="FloodDuration_intra-annual.html">Flood Duration</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jwfiedler/SL_Hawaii/main?urlpath=tree/notebooks/contributions.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/edit/main/notebooks/contributions.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/issues/new?title=Issue%20on%20page%20%2Fnotebooks/contributions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/contributions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Contributions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-data">Compile data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-station-and-climate-indices">Choose station and climate indices</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-dataframe">Create a dataframe</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-parameter-magnitudes">Plot the parameter magnitudes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-all-models">Plot all models</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-components-in-time">Plot Components in time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-components-by-station">Plot components by station</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-a-map">Plot a map</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-sub-annual-contributions">Plot sub-annual contributions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="contributions">
<h1>Contributions<a class="headerlink" href="#contributions" title="Permalink to this heading">#</a></h1>
<p>Inspiration for these plots and analysis follows from <span id="id1">Marra <em>et al.</em> [<a class="reference internal" href="#id17" title="John J. Marra, William V. Sweet, Eric Leuliette, Michael Kruk, Ayesha S. Genz, Curt D. Storlazzi, Peter Ruggiero, Meredith Leung, Dylan Anderson, Mark A. Merrifield, Janet M. Becker, Ian Robertson, Matthew J. Widlandsky, Philip Thompson, Fernando J. Mendez, Ana Rueda, Jose A. A. Antolinez, Laura Cagigal, Melisa Menéndez, Hector Lobeto, Jayantha Obeysekera, and Chris Chiesa. Advancing Best Practices for the Analysis of the Vulnerability of Military Installations in the Pacific Basin to Coastal Flooding under a Changing Climate – RC-2644 Final Report. Technical Report, NOAA NESDIS National Centers for Environmental Information (NCEI), 2023.">2</a>]</span> and <span id="id2">Sweet <em>et al.</em> [<a class="reference internal" href="#id30" title="William V. Sweet, Ayesha S. Genz, Melisa Menendez, John J. Marra, and Jayantha Obeysekera. Implications of Variability and Trends in Coastal Extreme Water Levels. Geophysical Research Letters, 51(14):e2024GL108864, 2024. doi:10.1029/2024GL108864.">4</a>]</span>, which use the nonstationary GEV analysis of <span id="id3">Méndez <em>et al.</em> [<a class="reference internal" href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html#id9" title="Fernando J. Méndez, Melisa Menéndez, Alberto Luceño, and Inigo J. Losada. Analyzing Monthly Extreme Sea Levels with a Time-Dependent GEV Model. Journal of Atmospheric and Oceanic Technology, May 2007. doi:10.1175/JTECH2009.1.">1</a>]</span> to analyze the influence of climatic patterns like ENSO and PDO (for example) on extreme sea levels. This notebook changes only one aspect of the method - allowing for a lagged covariate in the nonstationary GEV model.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<p>First we’ll import the necessary functions, set up our directories, and get everything ready for plotting.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> setup.ipynb
<span class="o">%</span><span class="k">run</span> plotting_functions.ipynb
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;../&quot;</span><span class="p">))</span>  <span class="c1"># For interactive mode (Jupyter/IPython)</span>
<span class="n">pythonPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;nonstationaryGEV&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pythonPath</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">imports</span> <span class="kn">import</span> <span class="n">make_directoryDict</span>
<span class="kn">from</span> <span class="nn">helpers</span> <span class="kn">import</span> <span class="n">adjust_w_for_plotting</span>
<span class="kn">from</span> <span class="nn">maps</span> <span class="kn">import</span> <span class="n">plot_thin_map_hawaii</span><span class="p">,</span> <span class="n">get_stationinfo</span>


<span class="c1"># set up directories to read from</span>
<span class="n">dirs</span> <span class="o">=</span> <span class="n">make_directoryDict</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
</pre></div>
</div>
</div>
</div>
<section id="compile-data">
<h3>Compile data<a class="headerlink" href="#compile-data" title="Permalink to this heading">#</a></h3>
<p>Before running this, you will need to run the non-stationary models. In the following codes we are just compiling the output and results from those models that have been saved to “model_output_dir” directory. The methodology contained herein follows <span id="id4">Sweet <em>et al.</em> [<a class="reference internal" href="#id30" title="William V. Sweet, Ayesha S. Genz, Melisa Menendez, John J. Marra, and Jayantha Obeysekera. Implications of Variability and Trends in Coastal Extreme Water Levels. Geophysical Research Letters, 51(14):e2024GL108864, 2024. doi:10.1029/2024GL108864.">4</a>]</span>.</p>
<section id="choose-station-and-climate-indices">
<h4>Choose station and climate indices<a class="headerlink" href="#choose-station-and-climate-indices" title="Permalink to this heading">#</a></h4>
<p>Here we’ll use all tested indices</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climateIndex</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="s1">&#39;BEST&#39;</span><span class="p">,</span><span class="s1">&#39;ONI&#39;</span><span class="p">,</span><span class="s1">&#39;PDO&#39;</span><span class="p">,</span><span class="s1">&#39;PMM&#39;</span><span class="p">,</span><span class="s1">&#39;PNA&#39;</span><span class="p">,</span><span class="s1">&#39;TNA&#39;</span><span class="p">]</span>

<span class="c1"># get list of all directories in dirs[&#39;model_output_dir&#39;]</span>
<span class="n">dirs_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span>

<span class="c1"># only keep the directories that are numbers</span>
<span class="n">recordIDs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs_list</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>


<span class="c1"># get station names from the best_params.json files</span>
<span class="n">station_names</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">recordID</span> <span class="ow">in</span> <span class="n">recordIDs</span><span class="p">:</span>
    <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;best_params.json&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">station_names</span><span class="p">[</span><span class="n">recordID</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;modelInfo&#39;</span><span class="p">][</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span>

<span class="c1"># sort the station names by the recordID</span>
<span class="n">station_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">station_names</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>

<span class="n">station_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{50: &#39;Midway&#39;,
 52: &#39;Johnston&#39;,
 57: &#39;Honolulu, Hawaii&#39;,
 58: &#39;Nawiliwili&#39;,
 59: &#39;Kahului&#39;,
 60: &#39;Hilo, Hawaii&#39;,
 61: &#39;Mokuoloe&#39;,
 552: &#39;Kawaihae&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-dataframe">
<h4>Create a dataframe<a class="headerlink" href="#create-a-dataframe" title="Permalink to this heading">#</a></h4>
<p>This will hold information about the amplitude of the tested climate index signals in the location parameter of the best-fit nonstationary GEV model.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%%</span>
<span class="k">for</span> <span class="n">recordID</span> <span class="ow">in</span> <span class="n">recordIDs</span><span class="p">:</span>
    <span class="c1"># Initialize an empty list to store results</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">SignifCvte1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">climateIndex</span><span class="p">))</span>
    <span class="n">w_nodal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">climateIndex</span><span class="p">))</span>
    <span class="n">w_cvte1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">climateIndex</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">climateIndex</span><span class="p">)):</span>
        <span class="c1">#read first value of w from trend_params.json</span>
        <span class="n">nodal_params</span> <span class="o">=</span> <span class="s1">&#39;nodal_params.json&#39;</span>
        <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="n">nodal_params</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">w_nodal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">covariate_params</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cvte_location_params_</span><span class="si">{</span><span class="n">climateIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">.json&#39;</span>

        <span class="c1"># Create the full path for the JSON file</span>
        <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="n">covariate_params</span>

        <span class="c1"># Open and read the JSON file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">mio</span><span class="p">,</span> <span class="n">standard_error</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;mio&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_error&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>

        <span class="n">wfull</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>

        <span class="c1"># prepend standard error with 0 to match the size of w</span>
        <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">standard_error</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">standard_error</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">standard_error</span><span class="p">)</span>

        <span class="c1"># Store the results in a list</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;Climate Index&#39;</span><span class="p">:</span> <span class="n">climateIndex</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="s1">&#39;CI param&#39;</span><span class="p">:</span> <span class="n">wfull</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>  
            <span class="s1">&#39;Standard Error of CI param&#39;</span><span class="p">:</span> <span class="n">standard_error</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># Compute deviance statistic</span>
        <span class="n">w_cvte1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">diffe</span> <span class="o">=</span> <span class="n">w_cvte1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">w_nodal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">SignifCvte1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">diffe</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="c1"># Convert the results list to a DataFrame</span>
    <span class="n">df_cvteLocation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="c1"># add Significance to the dataframe</span>
    <span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;Significance (over Nodal)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SignifCvte1</span>


    <span class="c1"># add the lags from CI_correlation_results.csv</span>
    <span class="n">CI_correlation_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;CI_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;CI_correlation_results_v2.csv&#39;</span><span class="p">)</span>

    <span class="c1">#rename climateIndex to Climate Index</span>
    <span class="n">CI_correlation_results</span> <span class="o">=</span> <span class="n">CI_correlation_results</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;climateIndex&#39;</span><span class="p">:</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">})</span>
    
    <span class="c1"># extract only the reocrdID of interest</span>
    <span class="n">CI_corr</span> <span class="o">=</span> <span class="n">CI_correlation_results</span><span class="p">[</span><span class="n">CI_correlation_results</span><span class="p">[</span><span class="s1">&#39;recordID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">recordID</span><span class="p">]</span>
    
    <span class="c1"># add the lags from CI_correlation_results[&#39;lag&#39;] to df_cvteLocation, matching on Climate Index and recordID</span>
    <span class="n">df_cvteLocation</span> <span class="o">=</span> <span class="n">df_cvteLocation</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">CI_corr</span><span class="p">[[</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">,</span><span class="s1">&#39;lag&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">)</span>


    <span class="c1">#save to a json file</span>
    <span class="n">df_cvteLocation</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;cvte_location_params_ALL.json&#39;</span><span class="p">)</span>
    <span class="n">df_cvteLocation</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-the-parameter-magnitudes">
<h4>Plot the parameter magnitudes<a class="headerlink" href="#plot-the-parameter-magnitudes" title="Permalink to this heading">#</a></h4>
<p>First let’s take a look at an example dataframe showing the influence of each climate index as covariate in the nonstationary GEV model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recordID</span> <span class="o">=</span> <span class="mi">57</span>
<span class="n">df_cvteLocation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;cvte_location_params_ALL.json&#39;</span><span class="p">)</span>
<span class="n">df_cvteLocation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Climate Index</th>
      <th>CI param</th>
      <th>Standard Error of CI param</th>
      <th>Significance (over Nodal)</th>
      <th>lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AO</td>
      <td>0.011489</td>
      <td>0.004334</td>
      <td>0.992358</td>
      <td>26</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BEST</td>
      <td>0.027613</td>
      <td>0.003459</td>
      <td>1.000000</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ONI</td>
      <td>0.023994</td>
      <td>0.003319</td>
      <td>1.000000</td>
      <td>18</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PDO</td>
      <td>0.026923</td>
      <td>0.004178</td>
      <td>1.000000</td>
      <td>16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PMM</td>
      <td>0.018782</td>
      <td>0.003680</td>
      <td>1.000000</td>
      <td>10</td>
    </tr>
    <tr>
      <th>5</th>
      <td>PNA</td>
      <td>0.004901</td>
      <td>0.004816</td>
      <td>0.621647</td>
      <td>11</td>
    </tr>
    <tr>
      <th>6</th>
      <td>TNA</td>
      <td>0.007613</td>
      <td>0.004441</td>
      <td>0.919458</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">recordID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recordIDs</span><span class="p">):</span>
     
    <span class="n">station_name</span> <span class="o">=</span> <span class="n">station_names</span><span class="p">[</span><span class="n">recordID</span><span class="p">]</span>
    <span class="c1"># Create the full path for the JSON file</span>
    <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;cvte_location_params_ALL.json&#39;</span>

     <span class="c1"># Open and read the JSON file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
    <span class="n">df_cvteLocation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="c1"># Define colors based on significance</span>
    <span class="n">location_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;Significance (over Nodal)&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>


    <span class="c1"># Plot the Location parameter with custom colors for significance</span>
    <span class="n">df_cvteLocation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;CI param&#39;</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span>  <span class="c1"># Horizontal bar plot</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">location_colors</span>
    <span class="p">)</span>

    <span class="c1"># add error bars</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;CI param&#39;</span><span class="p">],</span> <span class="n">df_cvteLocation</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                   <span class="n">xerr</span><span class="o">=</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;Standard Error of CI param&#39;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="c1"># add lag to each bar</span>
    
    <span class="n">halign</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_cvteLocation</span><span class="p">)):</span>
        <span class="n">xoffset</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">if</span> <span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;CI param&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">xoffset</span> <span class="o">=</span> <span class="o">-</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;CI param&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">xoffset</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;CI param&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">xoffset</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">halign</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>


    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Remove y-axis label</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># remove x-tick labels</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="c1"># set all axes to the same scale</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="c1"># set xticks to have only 3 ticks</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># rotate xticks</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

    <span class="c1"># set fontsize of xticks</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">station_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># add super title</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Climate Index Coefficient Magnitude in Location parameter&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># add y label to full plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># add x label to full plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Coefficient magnitude (cm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>


<span class="c1"># glue figure</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;CI_mag_inLocation&quot;</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;CI_mag_location.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/cb0f6dd9d6bdae3d2341025fe1d8457bd4df6524fb1f5b6c1ea65daaeb40a6e7.png" src="../_images/cb0f6dd9d6bdae3d2341025fe1d8457bd4df6524fb1f5b6c1ea65daaeb40a6e7.png" />
</div>
</details>
</div>
<figure class="align-default" id="ci-mag-inlocation">
<img alt="../_images/cb0f6dd9d6bdae3d2341025fe1d8457bd4df6524fb1f5b6c1ea65daaeb40a6e7.png" src="../_images/cb0f6dd9d6bdae3d2341025fe1d8457bd4df6524fb1f5b6c1ea65daaeb40a6e7.png" />
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">A comparison of the magnitudes of the climate index covariate in the location parameter of the nonstationary GEV model. The tested climate indices are shown in green when their inclusion in the total model (after the inclusion of the nodal cycle) is considered a significant contribution. Coefficients which do not offer a significant improvement over the Nodal model are shown in gray. The lag (in months) is shown next to each bar plot. Note that for this run, we have held the PMM index at a 10 month lag (<span id="id5">Long <em>et al.</em> [<a class="reference internal" href="#id21" title="Xiaoyu Long, Matthew J. Widlansky, Fabian Schloesser, Philip R. Thompson, H. Annamalai, Mark A. Merrifield, and Hyang Yoon. Higher Sea Levels at Hawaii Caused by Strong El Niño and Weak Trade Winds. Journal of Climate, March 2020. doi:10.1175/JCLI-D-19-0221.1.">1</a>]</span> uses 8-month lag for upper 100m), PDO at 16 months, and ONI and BEST at 18 months for the Hawaiian Island stations (<span id="id6">Long <em>et al.</em> [<a class="reference internal" href="#id21" title="Xiaoyu Long, Matthew J. Widlansky, Fabian Schloesser, Philip R. Thompson, H. Annamalai, Mark A. Merrifield, and Hyang Yoon. Higher Sea Levels at Hawaii Caused by Strong El Niño and Weak Trade Winds. Journal of Climate, March 2020. doi:10.1175/JCLI-D-19-0221.1.">1</a>]</span> find a 19-month lag for Niño3). Johnston and Midway are considered to be far enough away from the Hawaiian Island chain to have their own respective lags.</span><a class="headerlink" href="#ci-mag-inlocation" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Note that here PDO, BEST, PMM and ONI all have the same lag if they are Hawaiian Island stations. This is a fixed lag based on average results across all stations and/or pre-existing literature. I’m doing this for consistency across the region.</p>
<p>For the record, we can look at the original “best” lags from the original correlation output file.</p>
<div class="cell tag_hide-input tag_hide-ouput tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">dfLagsOriginal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;CI_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;CI_correlation_results.csv&#39;</span><span class="p">)</span>
<span class="n">dfLagsSet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;CI_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;CI_correlation_results_v2.csv&#39;</span><span class="p">)</span>

<span class="n">CInames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PMM&#39;</span><span class="p">,</span><span class="s1">&#39;PDO&#39;</span><span class="p">,</span><span class="s1">&#39;BEST&#39;</span><span class="p">,</span><span class="s1">&#39;ONI&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">barlabel</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">yoffset</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">valign</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yoffset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span>
        <span class="n">valign</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">yoffset</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">bar</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">())</span>
    

<span class="c1"># Plot the bars side by side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">CIname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">CInames</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">CIname</span> <span class="o">=</span> <span class="n">CInames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">dfLagsCI_1</span> <span class="o">=</span> <span class="n">dfLagsOriginal</span><span class="p">[</span><span class="n">dfLagsOriginal</span><span class="p">[</span><span class="s1">&#39;climateIndex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">CIname</span><span class="p">])]</span>
    <span class="n">dfLagsCI_2</span> <span class="o">=</span> <span class="n">dfLagsSet</span><span class="p">[</span><span class="n">dfLagsSet</span><span class="p">[</span><span class="s1">&#39;climateIndex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">CIname</span><span class="p">])]</span>

    <span class="c1"># Define bar width</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.4</span>  

    <span class="c1"># Create numerical x positions for stations</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="n">dfLagsCI_1</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">))</span>  <span class="c1"># Numeric x positions</span>



    <span class="n">bars1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dfLagsCI_1</span><span class="p">[</span><span class="s1">&#39;max_corr&#39;</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Automated Lag Finding&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">bars2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dfLagsCI_2</span><span class="p">[</span><span class="s1">&#39;max_corr&#39;</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Set Lags&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars1</span><span class="p">):</span>
        <span class="n">barlabel</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">dfLagsCI_1</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">barlabel</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bars2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">dfLagsCI_2</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="c1"># make the bars transparent if they are not significant</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dfLagsCI_1</span><span class="p">[</span><span class="s1">&#39;significant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dfLagsCI_2</span><span class="p">[</span><span class="s1">&#39;significant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
                


    <span class="c1"># Set x-axis labels to station names</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Remove x-axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Correlation at Lag&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Add labels and legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">CIname</span><span class="p">)</span>

    <span class="c1"># set y-axis limits</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Correlation at Lag for Climate Indices&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;CI_lag_correlation&quot;</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/edd434434f63f4d15c0327c5337027f31aeb701606f75f1222820ef5593b55b8.png" src="../_images/edd434434f63f4d15c0327c5337027f31aeb701606f75f1222820ef5593b55b8.png" />
</div>
</details>
</div>
<figure class="align-default" id="ci-lag-correlation">
<img alt="../_images/edd434434f63f4d15c0327c5337027f31aeb701606f75f1222820ef5593b55b8.png" src="../_images/edd434434f63f4d15c0327c5337027f31aeb701606f75f1222820ef5593b55b8.png" />
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">In this plot we examine the differences between holding the lag constant for the four climate indices shown, or allowing the algorithm to find the peak correlation automatically. For PMM, there is little change in correlation between using the set or auto lag. Likewise with PDO, with the exception of Nawiliwili and Kawaihae. In examining the full lagged correlations for these two stations, it is clear that for both stations PDO is less correlated in general when compared to other climate indices.</span><a class="headerlink" href="#ci-lag-correlation" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="plot-all-models">
<h4>Plot all models<a class="headerlink" href="#plot-all-models" title="Permalink to this heading">#</a></h4>
<p>Next we’ll look at all models and how they compare.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only do Honolulu for now</span>
<span class="c1"># recordID = &#39;59_new&#39;</span>
<span class="n">recordID</span> <span class="o">=</span> <span class="mi">57</span>

<span class="n">modelTypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RL_muT&#39;</span><span class="p">,</span> <span class="s1">&#39;RL_muN&#39;</span><span class="p">,</span><span class="s1">&#39;RL_muT_cv1&#39;</span><span class="p">,</span><span class="s1">&#39;RL_muT_cv2&#39;</span><span class="p">,</span><span class="s1">&#39;RL_muT_N_cv1&#39;</span><span class="p">,</span><span class="s1">&#39;RL_muT_N_cv2&#39;</span><span class="p">,</span><span class="s1">&#39;RL_best&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">modelType</span> <span class="ow">in</span> <span class="n">modelTypes</span><span class="p">:</span>
    <span class="n">modelName</span> <span class="o">=</span> <span class="n">modelType</span> <span class="o">+</span> <span class="s1">&#39;.nc&#39;</span>
    <span class="n">modelPath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="n">modelName</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">modelPath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">continue</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">modelPath</span><span class="p">)</span>

    <span class="n">model</span><span class="p">[</span><span class="s1">&#39;ReturnLevel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">modelType</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># put the legend outside the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="c1"># read the json file for best model</span>
<span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;best_params.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">modelInfo</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;modelInfo&#39;</span><span class="p">]</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;monthlyMax&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monthly Maxima&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Return Levels: &#39;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">])</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b43b59425c41194b74a8a45cf457614b5f302a8bb8155a04c62ceeb93ad65d8c.png" src="../_images/b43b59425c41194b74a8a45cf457614b5f302a8bb8155a04c62ceeb93ad65d8c.png" />
</div>
</div>
</section>
</section>
<section id="plot-components-in-time">
<h3>Plot Components in time<a class="headerlink" href="#plot-components-in-time" title="Permalink to this heading">#</a></h3>
<p>First we’ll make a function for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_location</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># Unpack the w array</span>
    <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">,</span> <span class="n">b5</span><span class="p">,</span> <span class="n">b6</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">a0</span><span class="p">,</span> <span class="n">bLT</span><span class="p">,</span> <span class="n">bCI</span><span class="p">,</span> <span class="n">aCI</span><span class="p">,</span> <span class="n">bN1</span><span class="p">,</span> <span class="n">bN2</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>

    <span class="c1"># Check if w[10] (bCI) is zero (i.e., no covariate contribution)</span>
    <span class="k">if</span> <span class="n">bCI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="n">CI</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Covariate is zero if bCI is zero</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span> 
        <span class="n">CI</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;covariate&#39;</span><span class="p">])</span>  <span class="c1"># Covariate values</span>

        

    <span class="c1"># Make sure CI and ti are aligned (if CI is a series)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CI</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">CI</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ti</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of covariate CI does not match the length of ti.&quot;</span><span class="p">)</span>

    <span class="c1"># Define mut (location(t)) as a function of ti and CI</span>
    <span class="n">mut</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bLT</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
           <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
           <span class="n">b3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
           <span class="n">b5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
           <span class="n">bN1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">18.61</span><span class="p">)</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">bN2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">18.61</span><span class="p">)</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
           <span class="p">(</span><span class="n">bCI</span> <span class="o">*</span> <span class="n">CI</span><span class="p">))</span>  

    <span class="c1"># Calculate the amplitudes for each harmonic and the covariate</span>
    <span class="n">amp_annual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>      <span class="c1"># First harmonic (annual cycle)</span>
    <span class="n">amp_semiannual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b3</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b4</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Second harmonic (semiannual cycle)</span>
    <span class="n">amp_third</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b5</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b6</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># Third harmonic (quarterly or 8π cycle)</span>
    <span class="n">amp_nodal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bN1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bN2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>     <span class="c1"># Nodal component</span>
    <span class="n">amp_covariate</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bCI</span><span class="p">)</span>                 <span class="c1"># Covariate amplitude</span>
    <span class="n">amp_trend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bLT</span> <span class="o">*</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">b0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bLT</span> <span class="o">*</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Trend amplitude</span>



    <span class="n">amp_seasonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">amp_annual</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_semiannual</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_third</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Calculate the total amplitude</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">amp_seasonal</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_nodal</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_covariate</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_trend</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    


    <span class="c1"># Subtract the datum offset</span>
    <span class="n">mut</span> <span class="o">=</span> <span class="n">mut</span> <span class="o">-</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;STNDtoMHHW&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">component</span><span class="p">:</span>
        <span class="n">mut_demeaned</span> <span class="o">=</span> <span class="n">mut</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mut</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mut_demeaned</span> <span class="o">=</span> <span class="n">mut</span>
    
    <span class="c1"># mut_demeaned = mut_demeaned - modelInfo[&#39;STNDtoMHHW&#39;]</span>
    
    <span class="c1"># add zero line for reference in gray</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Plot the result</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ti</span><span class="o">+</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">],</span> <span class="n">mut_demeaned</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">amp</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; cm)&#39;</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">amp</span>
</pre></div>
</div>
</div>
</div>
<p>Then we’ll make a function for making the figure.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make figure</span>
<span class="k">def</span> <span class="nf">make_component_figure</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">returnYear</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># Add returnYear-year return level to the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">model</span><span class="p">[</span><span class="s1">&#39;ReturnLevel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="o">=</span><span class="n">returnYear</span><span class="p">)</span><span class="o">-</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;STNDtoMHHW&#39;</span><span class="p">],</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">returnYear</span><span class="si">}</span><span class="s1">-year Return Level&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 

    <span class="c1"># add error bars as shaded area from model[&#39;RL_low&#39;] to model[&#39;RL_high&#39;]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> 
                    <span class="n">model</span><span class="p">[</span><span class="s1">&#39;RL_high&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="o">=</span><span class="n">returnYear</span><span class="p">)</span><span class="o">-</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;STNDtoMHHW&#39;</span><span class="p">],</span> 
                    <span class="n">model</span><span class="p">[</span><span class="s1">&#39;RL_low&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="o">=</span><span class="n">returnYear</span><span class="p">)</span><span class="o">-</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;STNDtoMHHW&#39;</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># Add monthly maxima, centered</span>
    <span class="n">mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;monthlyMax&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;STNDtoMHHW&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monthly Maxima&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">amp_full</span> <span class="o">=</span> <span class="n">plot_location</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Full $\mu(t)$&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># First plot: Covariate contribution</span>
    <span class="n">wnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">wnew</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># Only use the covariate component</span>
    <span class="n">offset1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>  <span class="c1"># Offset for the plot</span>
    <span class="n">amp_CI</span> <span class="o">=</span> <span class="n">plot_location</span><span class="p">(</span><span class="n">wnew</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;covariateName&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset1</span><span class="p">)</span>


    <span class="c1"># Second plot: Seasonal components</span>
    <span class="n">wnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">wnew</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>  <span class="c1"># Seasonal components</span>
    <span class="n">offset1</span> <span class="o">-=</span> <span class="mf">0.2</span>  <span class="c1"># Increment offset correctly</span>
    <span class="n">amp_S</span> <span class="o">=</span> <span class="n">plot_location</span><span class="p">(</span><span class="n">wnew</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset1</span><span class="p">)</span>

    <span class="c1"># Third plot: Long-term trend</span>
    <span class="n">wnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">wnew</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>  <span class="c1"># Long-term trend component</span>
    <span class="n">wnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Plus base value</span>
    <span class="n">offset1</span> <span class="o">-=</span> <span class="mf">0.2</span>  <span class="c1"># Increment offset correctly</span>
    <span class="n">amp_LT</span> <span class="o">=</span> <span class="n">plot_location</span><span class="p">(</span><span class="n">wnew</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Long-term trend&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset1</span><span class="p">)</span>


    <span class="c1"># Fourth plot: Nodal component</span>
    <span class="n">wnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">wnew</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span>  <span class="c1"># Nodal components</span>
    <span class="n">offset1</span> <span class="o">-=</span> <span class="mf">0.2</span>  <span class="c1"># Increment offset correctly</span>
    <span class="n">amp_N</span> <span class="o">=</span> <span class="n">plot_location</span><span class="p">(</span><span class="n">wnew</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Nodal&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Location Parameter Components: &#39;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">],</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Height above MHHW (m)&#39;</span><span class="p">)</span>

    <span class="c1"># Add legend to the outside of the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>

    <span class="c1"># add a second y-axis on the right side to label components</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset1</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39; Full $\mu(t)$&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                      <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;covariateName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; $\mu_</span><span class="si">{CI}</span><span class="s1">(t)$&#39;</span> <span class="p">,</span> 
                      <span class="s1">&#39; Seasonal $\mu_</span><span class="si">{S}</span><span class="s1">(t)$&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39; Long-term trend $\mu_</span><span class="si">{LT}</span><span class="s1">(t)$&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39; Nodal $\mu_</span><span class="si">{N}</span><span class="s1">(t)$&#39;</span><span class="p">]);</span> <span class="c1">#not sure why there&#39;s output here but I&#39;ve suppressed it  </span>
    
    <span class="n">amps</span> <span class="o">=</span> <span class="p">[</span><span class="n">amp_full</span><span class="p">,</span> <span class="n">amp_CI</span><span class="p">,</span> <span class="n">amp_S</span><span class="p">,</span> <span class="n">amp_LT</span><span class="p">,</span> <span class="n">amp_N</span><span class="p">]</span>
    <span class="n">amp_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span> <span class="s1">&#39;Covariate&#39;</span><span class="p">,</span> <span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span> <span class="s1">&#39;Long-term trend&#39;</span><span class="p">,</span> <span class="s1">&#39;Nodal&#39;</span><span class="p">]</span>

        <span class="c1"># Get the default color cycle</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
<span class="c1">#     x_line_position = ax.get_xlim()[1] + 0.5</span>
    <span class="n">x_line_position</span> <span class="o">=</span> <span class="mf">0.86</span>
    <span class="n">y_ticks</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
    <span class="c1"># Draw vertical lines on the figure using figure-relative coordinates</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amps</span><span class="p">):</span>
        <span class="n">ymin_fig</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">amp</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Bottom of the line</span>
        <span class="n">ymax_fig</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">amp</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Top of the line</span>
        <span class="n">ymin_norm</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin_fig</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Convert to figure normalized</span>
        <span class="n">ymax_norm</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax_fig</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Convert to figure normalized</span>
        
        <span class="c1"># Plot vertical line in figure coordinates</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="n">x_line_position</span><span class="p">,</span> <span class="n">x_line_position</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin_norm</span><span class="p">,</span> <span class="n">ymax_norm</span><span class="p">],</span>
                                    <span class="n">transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span>
                                    <span class="n">color</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>


    <span class="n">amps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">amp_names</span><span class="p">,</span> <span class="n">amps</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Finally, we’ll plot it up!</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">recordID</span> <span class="ow">in</span> <span class="n">recordIDs</span><span class="p">:</span>

    <span class="c1"># read the json file for best model</span>
    <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;best_params.json&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">modelInfo</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;modelInfo&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        
    <span class="n">time</span> <span class="o">=</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">modelType</span> <span class="o">=</span> <span class="s1">&#39;RL_best.nc&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="n">modelType</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_component_figure</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="c1">#save the figure</span>
    <span class="n">savename</span> <span class="o">=</span> <span class="s1">&#39;LocationComponents_&#39;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">savename</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="c1"># save amps to a json file</span>
    <span class="n">amps_json</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;location_param_component_amps.json&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">amps_json</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/25dcb312cb6ee7eb5c3b31060f7c4951699c670f5d3e453459125a2ff2ed5a8c.png" src="../_images/25dcb312cb6ee7eb5c3b31060f7c4951699c670f5d3e453459125a2ff2ed5a8c.png" />
<img alt="../_images/2a53745abdeaf6b5863e2846bb30c4c5dc1e7ea65ce0f2c919463cded26c44be.png" src="../_images/2a53745abdeaf6b5863e2846bb30c4c5dc1e7ea65ce0f2c919463cded26c44be.png" />
<img alt="../_images/65e8c44d4696f24f544cb8411f9587e13722a67ad6cbec69814a97f0e4df795f.png" src="../_images/65e8c44d4696f24f544cb8411f9587e13722a67ad6cbec69814a97f0e4df795f.png" />
<img alt="../_images/43cab253a5408c7f324ad0b1452f695db1256af4087e3fcc558f32099786005b.png" src="../_images/43cab253a5408c7f324ad0b1452f695db1256af4087e3fcc558f32099786005b.png" />
<img alt="../_images/5487b6c777f916fbf64fd250883b4780209835f78d3afd02f0dfedf13cd50c80.png" src="../_images/5487b6c777f916fbf64fd250883b4780209835f78d3afd02f0dfedf13cd50c80.png" />
<img alt="../_images/d02f327dc078868ec8bb27b3c9fbea4b66eec0c1bcdf3f17ec2757857a952cd2.png" src="../_images/d02f327dc078868ec8bb27b3c9fbea4b66eec0c1bcdf3f17ec2757857a952cd2.png" />
<img alt="../_images/da7a72183b8d8a2a724fe3bbd891d4e74d4140312bf851ebbaaced54bd0fa212.png" src="../_images/da7a72183b8d8a2a724fe3bbd891d4e74d4140312bf851ebbaaced54bd0fa212.png" />
<img alt="../_images/74ef78efe68ff342a8eb7b764134996b0a1b676b844699cbdb6cbcb0d6d46cb9.png" src="../_images/74ef78efe68ff342a8eb7b764134996b0a1b676b844699cbdb6cbcb0d6d46cb9.png" />
</div>
</details>
</div>
<p>Now we’ll save the parameter component amplitudes to our model output directory.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recordID</span> <span class="o">=</span> <span class="mi">57</span>

<span class="c1"># read the json file for best model</span>
<span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;best_params.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">modelInfo</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;modelInfo&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        
<span class="n">time</span> <span class="o">=</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="n">modelType</span> <span class="o">=</span> <span class="s1">&#39;RL_best.nc&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="n">modelType</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_component_figure</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">modelInfo</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;location_components&quot;</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">],</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/43cab253a5408c7f324ad0b1452f695db1256af4087e3fcc558f32099786005b.png" src="../_images/43cab253a5408c7f324ad0b1452f695db1256af4087e3fcc558f32099786005b.png" />
</div>
</details>
</div>
<figure class="align-default" id="location-components">
<img alt="../_images/43cab253a5408c7f324ad0b1452f695db1256af4087e3fcc558f32099786005b.png" src="../_images/43cab253a5408c7f324ad0b1452f695db1256af4087e3fcc558f32099786005b.png" />
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">Location parameter components for the <span class="pasted-text">Honolulu, Hawaii</span> tide gauge.</span><a class="headerlink" href="#location-components" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="plot-components-by-station">
<h3>Plot components by station<a class="headerlink" href="#plot-components-by-station" title="Permalink to this heading">#</a></h3>
<p>The following code can only be run after all gauges have been modeled!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get all location_parms_component_amp.json files and combine them into one</span>
<span class="n">amps</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">recordID</span> <span class="ow">in</span> <span class="n">recordIDs</span><span class="p">:</span>
    <span class="n">amps_json</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;location_param_component_amps.json&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">amps_json</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">amps</span><span class="p">[</span><span class="n">recordID</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot df as stacked bar chart ignoring the full component</span>
<span class="c1"># Turn amps into a dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Reorder columns to match above plot</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Covariate&#39;</span><span class="p">,</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">,</span> <span class="s1">&#39;Long-term trend&#39;</span><span class="p">,</span>  <span class="s1">&#39;Nodal&#39;</span><span class="p">]]</span>
<span class="c1">#rename &#39;Covariate&#39; to &#39;BEST (19-month lag)&#39;</span>
<span class="c1"># df = df.rename(columns={&#39;Covariate&#39;:&#39;BEST (19-month lag)&#39;})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="c1"># conver the data colums to cm and round to 2 decimal places</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># add station names to the dataframe</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Station Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_names</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>


<span class="c1"># Plot the data with amplitudes on the x-axis</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Location Parameter Component Amplitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># replace the x-axis with the station names</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Station Name&#39;</span><span class="p">]);</span>

<span class="c1"># save the plot</span>
<span class="n">savename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;location_param_component_amps.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/74a656b8e8ff39c4f93c86bea39088fe6a26612775ae9be0194d702351e87b88.png" src="../_images/74a656b8e8ff39c4f93c86bea39088fe6a26612775ae9be0194d702351e87b88.png" />
</div>
</div>
</section>
<section id="plot-a-map">
<h3>Plot a map<a class="headerlink" href="#plot-a-map" title="Permalink to this heading">#</a></h3>
<p>Here we’ll look at the influence of the climate covariate in the form of a map. First we’ll extract the amplitudes of the covariate from every station we’ve analyzed.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load rsl data</span>
<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;rsl_daily_hawaii.nc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rsl</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">rsl</span><span class="p">[[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;station_name&#39;</span><span class="p">,</span> <span class="s1">&#39;record_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">pass</span>

<span class="c1"># Initialize ampCI as a vector of zeros</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Assign ampCI values using the recordID column with vectorization, where possible</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rid</span><span class="p">:</span> <span class="n">amps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Covariate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Initialize modelCI with &#39;None&#39; as default</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>

<span class="c1"># Function to get modelCI, with improved error handling</span>
<span class="k">def</span> <span class="nf">get_model_ci</span><span class="p">(</span><span class="n">record_id</span><span class="p">):</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">record_id</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;RL_best.nc&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;covariate&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No model found for recordID: </span><span class="si">{</span><span class="n">record_id</span><span class="si">}</span><span class="s1">, skipping...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error processing </span><span class="si">{</span><span class="n">record_id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>

<span class="c1"># Apply the function to the DataFrame (efficient vectorized operation)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_model_ci</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No model found for recordID: 14, skipping...
No model found for recordID: 547, skipping...
No model found for recordID: 548, skipping...
</pre></div>
</div>
</div>
</div>
<p>Next we’ll plot up our map.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># make all ampCI values if zero 0.05</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>



<span class="c1"># Separate the &quot;None&quot; entries from the rest of the data</span>
<span class="n">df_none</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">]</span>  <span class="c1"># Entries where modelCI is &#39;None&#39;</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">]</span>  <span class="c1"># All other entries</span>

<span class="c1"># Use tab10 colormap for colors (excluding &#39;None&#39;)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Set1&#39;</span><span class="p">)</span>
<span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]))}</span>

<span class="c1"># Map the climate indices to numerical values for the colorbar</span>
<span class="n">index_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]))}</span>
<span class="n">mapped_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">index_mapping</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span> <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]]</span>

<span class="c1"># Create a colormap without &quot;None&quot;</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> 
                               <span class="n">ncolors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">])))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>

<span class="c1"># # Call plot_thin_map_hawaii to create the figure and axis</span>
<span class="n">plot_thin_map_hawaii</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Plot each station with varying color (based on climate index) and size (based on amplitude)</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> 
                     <span class="n">c</span><span class="o">=</span><span class="n">mapped_indices</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> 
                     <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span> <span class="o">*</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">],</span>
                     <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="c1"># Plot the &quot;None&quot; stations in gray (fixed color)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_none</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">df_none</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> 
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span> <span class="o">*</span><span class="n">df_none</span><span class="p">[</span><span class="s1">&#39;ampCI&#39;</span><span class="p">],</span> 
           <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">dfInfo</span> <span class="o">=</span> <span class="n">get_stationinfo</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">])</span>
<span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span>

<span class="c1">#change the font color to black if the station is in the df_filtered</span>
<span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;fontcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]),</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Add an axes for the colorbar</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">])</span>  

<span class="c1"># dfInfo</span>
<span class="c1"># Add text labels with adjusted offsets and horizontal alignment</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;offsetlon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;offsetlat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> 
            <span class="n">ha</span><span class="o">=</span><span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dfInfo</span><span class="p">[</span><span class="s1">&#39;fontcolor&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Add a colorbar for the climate index</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]))))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;modelCI&#39;</span><span class="p">]))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">)</span>


<span class="c1"># Amplitude size legend</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">]</span>
<span class="n">size_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0.5 cm&quot;</span><span class="p">,</span> <span class="s2">&quot;1.5 cm&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0 cm&quot;</span><span class="p">]</span>  
<span class="n">size_legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> 
                               <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">size_labels</span><span class="p">)]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">size_legend_elements</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Amplitude Size&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">)</span>

<span class="c1"># save the figure</span>
<span class="n">savename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;SL_contributions_map.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;CI_map&quot;</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/8ce05677b3eceb6f39638c168b19a13daa18408d09bb75cc1083d5ed824216eb.png" src="../_images/8ce05677b3eceb6f39638c168b19a13daa18408d09bb75cc1083d5ed824216eb.png" />
</div>
</details>
</div>
<figure class="align-default" id="ci-map">
<img alt="../_images/8ce05677b3eceb6f39638c168b19a13daa18408d09bb75cc1083d5ed824216eb.png" src="../_images/8ce05677b3eceb6f39638c168b19a13daa18408d09bb75cc1083d5ed824216eb.png" />
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Map of dominant climate indices in the Hawaiian Islands region. The size of each circle at a given tide gauge represents the amplitude of the climate covariate in the location parameter of nonstationary extremes. ENSO-type climate indices are are well-represented with amplitudes between 1.5-3 cm. Here, the lags for ENSO-type indices in the main Hawaiian Islands are set at 18 months, which aligns well with previous literature (e.g. Long et al 2020).</span><a class="headerlink" href="#ci-map" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="plot-sub-annual-contributions">
<h3>Plot sub-annual contributions<a class="headerlink" href="#plot-sub-annual-contributions" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recordID</span> <span class="o">=</span> <span class="mi">57</span>
<span class="n">jsonpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;best_params.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">modelInfo</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;modelInfo&#39;</span><span class="p">]</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>    

<span class="c1"># params should be a dictionary with the following</span>
<span class="n">paramNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b0&#39;</span><span class="p">,</span><span class="s1">&#39;a0&#39;</span><span class="p">,</span><span class="s1">&#39;g0&#39;</span><span class="p">,</span><span class="s1">&#39;b1&#39;</span><span class="p">,</span> <span class="s1">&#39;b2&#39;</span><span class="p">,</span> <span class="s1">&#39;b3&#39;</span><span class="p">,</span> <span class="s1">&#39;b4&#39;</span><span class="p">,</span> <span class="s1">&#39;b5&#39;</span><span class="p">,</span> <span class="s1">&#39;b6&#39;</span><span class="p">,</span> <span class="s1">&#39;bLT&#39;</span><span class="p">,</span> <span class="s1">&#39;bCI&#39;</span><span class="p">,</span> <span class="s1">&#39;cCI&#39;</span><span class="p">,</span> <span class="s1">&#39;bN1&#39;</span><span class="p">,</span> <span class="s1">&#39;bN2&#39;</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">paramNames</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramNames</span><span class="p">))}</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
<span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;covariate&#39;</span><span class="p">])</span>
<span class="c1"># Convert t to years</span>
<span class="n">tyears</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;year0&#39;</span><span class="p">]</span>

<span class="c1"># Constants</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># pi</span>
<span class="n">ak</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">api</span> <span class="c1"># 2pi</span>
<span class="n">ak18</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">api</span> <span class="o">/</span> <span class="mf">18.61</span>  <span class="c1"># 18.61-year nodal cycle</span>

<span class="n">mut</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;b0&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;bLT&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ak</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ak</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b3&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ak</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ak</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b5&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">ak</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b6&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">ak</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bN1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ak18</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bN2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ak18</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bCI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ci</span><span class="p">)</span>

<span class="n">mut</span> <span class="o">=</span> <span class="n">mut</span> <span class="o">-</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;STNDtoMHHW&#39;</span><span class="p">]</span>


<span class="n">tfrac</span> <span class="o">=</span> <span class="n">t</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">calendar</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">t00</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1993</span><span class="p">,</span><span class="mi">2023</span><span class="p">)</span>
<span class="c1"># make colormap the same length as t00</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t00</span><span class="p">)))</span>
<span class="c1"># plt.plot(tyears(np.floor(tyears)==t00),mut[np.floor(tyears)==t00])</span>
<span class="k">for</span> <span class="n">t0</span> <span class="ow">in</span> <span class="n">t00</span><span class="p">:</span>
    <span class="n">inYear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tyears</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="n">t0</span>
    <span class="n">color_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t00</span> <span class="o">==</span> <span class="n">t0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Find the index of t0 in t00</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">),</span> <span class="n">mut</span><span class="p">[</span><span class="n">inYear</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">t0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>

<span class="c1"># xlim([0,1])</span>
<span class="c1"># set the xlimits to 0 and 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
<span class="c1"># set the xticks to be the months</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">),</span> <span class="p">[</span><span class="n">calendar</span><span class="o">.</span><span class="n">month_abbr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\mu_t$, relative to MHHW (m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Location Parameter by Year: &#39;</span> <span class="o">+</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">])</span>


<span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">t00</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">t00</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;location_by_year&quot;</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">savename</span> <span class="o">=</span> <span class="s1">&#39;location_by_year_&#39;</span> <span class="o">+</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">savename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1">#glue the CI name</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;CI_name&quot;</span><span class="p">,</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;covariateName&#39;</span><span class="p">],</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">,</span><span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">],</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># get lag for covariateName</span>
<span class="n">df_cvteLocation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;model_output_dir&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">recordID</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;cvte_location_params_ALL.json&#39;</span><span class="p">)</span>

<span class="n">CI_lag</span> <span class="o">=</span> <span class="n">df_cvteLocation</span><span class="p">[</span><span class="n">df_cvteLocation</span><span class="p">[</span><span class="s1">&#39;Climate Index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">modelInfo</span><span class="p">[</span><span class="s1">&#39;covariateName&#39;</span><span class="p">]][</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;CI_lag&quot;</span><span class="p">,</span><span class="n">CI_lag</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/5c02458f0446c9990b7ce73d7ca4311cc62b1dc291292b9180b0b87ca1e7600e.png" src="../_images/5c02458f0446c9990b7ce73d7ca4311cc62b1dc291292b9180b0b87ca1e7600e.png" />
</div>
</details>
</div>
<figure class="align-default" id="location-by-year">
<img alt="../_images/5c02458f0446c9990b7ce73d7ca4311cc62b1dc291292b9180b0b87ca1e7600e.png" src="../_images/5c02458f0446c9990b7ce73d7ca4311cc62b1dc291292b9180b0b87ca1e7600e.png" />
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">This plot shows the changes in the location parameter (with covariate included) from 1993 through 2023 for the non-stationary GEV model at <span class="pasted-text">Honolulu, Hawaii</span>. This particular calculation uses the <span class="pasted-text">BEST</span> climate index at a <span class="pasted-text">18</span>-month lag. While there is a steady trend (background sea level rise), this is also affected by the covariate and nodal influences.</span><a class="headerlink" href="#location-by-year" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="citations">
<h3>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h3>
<div class="docutils container" id="id7">
<dl class="citation">
<dt class="label" id="id21"><span class="brackets">1</span><span class="fn-backref">(<a href="#id5">1</a>,<a href="#id6">2</a>)</span></dt>
<dd><p>Xiaoyu Long, Matthew J. Widlansky, Fabian Schloesser, Philip R. Thompson, H. Annamalai, Mark A. Merrifield, and Hyang Yoon. Higher Sea Levels at Hawaii Caused by Strong El Niño and Weak Trade Winds. <em>Journal of Climate</em>, March 2020. <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0221.1">doi:10.1175/JCLI-D-19-0221.1</a>.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id1">2</a></span></dt>
<dd><p>John J. Marra, William V. Sweet, Eric Leuliette, Michael Kruk, Ayesha S. Genz, Curt D. Storlazzi, Peter Ruggiero, Meredith Leung, Dylan Anderson, Mark A. Merrifield, Janet M. Becker, Ian Robertson, Matthew J. Widlandsky, Philip Thompson, Fernando J. Mendez, Ana Rueda, Jose A. A. Antolinez, Laura Cagigal, Melisa Menéndez, Hector Lobeto, Jayantha Obeysekera, and Chris Chiesa. Advancing Best Practices for the Analysis of the Vulnerability of Military Installations in the Pacific Basin to Coastal Flooding under a Changing Climate – RC-2644 Final Report. Technical Report, NOAA NESDIS National Centers for Environmental Information (NCEI), 2023.</p>
</dd>
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Fernando J. Méndez, Melisa Menéndez, Alberto Luceño, and Inigo J. Losada. Analyzing Monthly Extreme Sea Levels with a Time-Dependent GEV Model. <em>Journal of Atmospheric and Oceanic Technology</em>, May 2007. <a class="reference external" href="https://doi.org/10.1175/JTECH2009.1">doi:10.1175/JTECH2009.1</a>.</p>
</dd>
<dt class="label" id="id30"><span class="brackets">4</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>William V. Sweet, Ayesha S. Genz, Melisa Menendez, John J. Marra, and Jayantha Obeysekera. Implications of Variability and Trends in Coastal Extreme Water Levels. <em>Geophysical Research Letters</em>, 51(14):e2024GL108864, 2024. <a class="reference external" href="https://doi.org/10.1029/2024GL108864">doi:10.1029/2024GL108864</a>.</p>
</dd>
</dl>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "jwfiedler/SL_Hawaii",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="nonstationaryGEV/monthly_extremes_non-stationaryGEV.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Nonstationary Extremes</p>
      </div>
    </a>
    <a class="right-next"
       href="Flood.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Minor Flood Frequency and Duration</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-data">Compile data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-station-and-climate-indices">Choose station and climate indices</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-dataframe">Create a dataframe</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-parameter-magnitudes">Plot the parameter magnitudes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-all-models">Plot all models</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-components-in-time">Plot Components in time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-components-by-station">Plot components by station</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-a-map">Plot a map</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-sub-annual-contributions">Plot sub-annual contributions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Playground Coordinator
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>