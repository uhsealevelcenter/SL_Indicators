Traceback (most recent call last):
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/nbclient/client.py", line 1314, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/asyncio/base_events.py", line 647, in run_until_complete
    return future.result()
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
recordID = 57
jsonpath = Path(dirs['model_output_dir']) / str(recordID) / 'best_params.json'
with open(jsonpath, 'r') as f:
    output = json.load(f)
    modelInfo = output['modelInfo']
    params = output['w']
    x = output['x']

w = adjust_w_for_plotting(x, params)    

# params should be a dictionary with the following
paramNames = ['b0','a0','g0','b1', 'b2', 'b3', 'b4', 'b5', 'b6', 'bLT', 'bCI', 'cCI', 'bN1', 'bN2']
params = {paramNames[i]: w[i] for i in range(len(paramNames))}

t = np.array(modelInfo['t'])
ci = np.array(modelInfo['covariate'])
# Convert t to years
tyears = t + modelInfo['year0']

# Constants
api = np.pi # pi
ak = 2 * api # 2pi
ak18 = 2 * api / 18.61  # 18.61-year nodal cycle

mut = (params['b0'] * np.exp(params['bLT'] * t) +
        params['b1'] * np.cos(ak * t) + params['b2'] * np.sin(ak * t) +
        params['b3'] * np.cos(2 * ak * t) + params['b4'] * np.sin(2 * ak * t) +
        params['b5'] * np.cos(4 * ak * t) + params['b6'] * np.sin(4 * ak * t) +
        params['bN1'] * np.cos(ak18 * t) + params['bN2'] * np.sin(ak18 * t) +
        params['bCI'] * ci)

mut = mut - modelInfo['STNDtoMHHW']


tfrac = t-np.floor(t)

import calendar
fig, ax = plt.subplots(1, 1, figsize=(10, 5))

t00 = np.arange(1993,2023)
# make colormap the same length as t00
cmap = plt.cm.Blues(np.linspace(0,1,len(t00)))
# plt.plot(tyears(np.floor(tyears)==t00),mut[np.floor(tyears)==t00])
for t0 in t00:
    inYear = np.floor(tyears).astype(int) == t0
    color_index = np.where(t00 == t0)[0][0]  # Find the index of t0 in t00
    plt.plot(np.arange(0, 1, 1/12), mut[inYear], label=str(t0), color=cmap[color_index])

# xlim([0,1])
# set the xlimits to 0 and 1
plt.xlim(0,1-1/12)
# set the xticks to be the months
plt.xticks(np.arange(0, 1, 1/12), [calendar.month_abbr[i] for i in range(1, 13)])
plt.xlabel('Month')
plt.ylabel('$\mu_t$, relative to MHHW (m)')
plt.title('Location Parameter by Year: ' + modelInfo['station_name'])


sm = plt.cm.ScalarMappable(cmap=plt.cm.Blues, norm=plt.Normalize(vmin=t00.min(), vmax=t00.max()))
cbar = plt.colorbar(sm, ax=plt.gca(), orientation='vertical', pad=0.02)
cbar.set_label('Year')

glue("location_by_year",fig,display=False)
savename = 'location_by_year_' + modelInfo['station_name'] + '.png'
plt.savefig(output_dir / savename, dpi=300, bbox_inches='tight')

#glue the CI name
glue("CI_name",modelInfo['covariateName'],display=False)
glue("station",modelInfo['station_name'],display=False)

# get lag for covariateName
df_cvteLocation = pd.read_json(Path(dirs['model_output_dir']) / str(recordID) / 'cvte_location_params_ALL.json')

CI_lags = df_cvteLocation[df_cvteLocation['Climate Index'] == modelInfo['covariateName']]['lag'].values
glue("CI_lag",CI_lag,display=False)
------------------


[0;31m---------------------------------------------------------------------------[0m
[0;31mNameError[0m                                 Traceback (most recent call last)
Cell [0;32mIn[16], line 75[0m
[1;32m     72[0m df_cvteLocation [38;5;241m=[39m pd[38;5;241m.[39mread_json(Path(dirs[[38;5;124m'[39m[38;5;124mmodel_output_dir[39m[38;5;124m'[39m]) [38;5;241m/[39m [38;5;28mstr[39m(recordID) [38;5;241m/[39m [38;5;124m'[39m[38;5;124mcvte_location_params_ALL.json[39m[38;5;124m'[39m)
[1;32m     74[0m CI_lags [38;5;241m=[39m df_cvteLocation[df_cvteLocation[[38;5;124m'[39m[38;5;124mClimate Index[39m[38;5;124m'[39m] [38;5;241m==[39m modelInfo[[38;5;124m'[39m[38;5;124mcovariateName[39m[38;5;124m'[39m]][[38;5;124m'[39m[38;5;124mlag[39m[38;5;124m'[39m][38;5;241m.[39mvalues
[0;32m---> 75[0m glue([38;5;124m"[39m[38;5;124mCI_lag[39m[38;5;124m"[39m,[43mCI_lag[49m,display[38;5;241m=[39m[38;5;28;01mFalse[39;00m)

[0;31mNameError[0m: name 'CI_lag' is not defined

